<!doctype html>
<html lang="ko">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Division Quest</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        .game-canvas {
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body>

  <img id="spaceship-img" src="spaceship.png" style="display: none;" alt="ìš°ì£¼ì„ ">
  <audio id="bgm-audio" src="background.mp3" loop preload="auto"></audio>
  <img id="meteor-img" src="meteo.png" style="display: none;" alt="ìš´ì„">


  
  <div id="root"></div>
  <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;
        const MAX_LEVEL = 10;

        // Firebase ì´ˆê¸°í™” ë° ê´€ë¦¬ í›…
        const useFirebase = () => {
            const [firebase, setFirebase] = useState(null);
            const [user, setUser] = useState(null);
            const [isInitialized, setIsInitialized] = useState(false);

            useEffect(() => {
                const initFirebase = async () => {
                    try {
                        // Firebase ëª¨ë“ˆ ë™ì  ë¡œë“œ
                        const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
                        const { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js');
                        const { getFirestore, doc, setDoc, getDoc, updateDoc } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');

                        // ìº”ë²„ìŠ¤ í™˜ê²½ ë³€ìˆ˜ ì‚¬ìš©
                        const appId = window.__app_id || 'division-quest-default';
                        const firebaseConfig = window.__firebase_config || {
                            apiKey: "demo-key",
                            authDomain: "demo.firebaseapp.com",
                            projectId: "demo-project",
                            storageBucket: "demo.appspot.com",
                            messagingSenderId: "123456789",
                            appId: appId
                        };

                        const app = initializeApp(firebaseConfig);
                        const auth = getAuth(app);
                        const firestore = getFirestore(app);

                        setFirebase({ 
                            appId, 
                            auth, 
                            firestore, 
                            doc, 
                            setDoc, 
                            getDoc, 
                            updateDoc,
                            signInAnonymously,
                            signInWithCustomToken
                        });

                        // ì¸ì¦ ì²˜ë¦¬
                        const initialAuthToken = window.__initial_auth_token;
                        if (initialAuthToken) {
                            // ì»¤ìŠ¤í…€ í† í°ìœ¼ë¡œ ë¡œê·¸ì¸
                            await signInWithCustomToken(auth, initialAuthToken);
                        } else {
                            // ìµëª… ë¡œê·¸ì¸
                            await signInAnonymously(auth);
                        }

                        onAuthStateChanged(auth, (user) => {
                            if (user) {
                                setUser(user);
                                setIsInitialized(true);
                            }
                        });

                    } catch (error) {
                        console.error('Firebase ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                        setIsInitialized(true); // ì˜¤í”„ë¼ì¸ ëª¨ë“œë¡œ ê³„ì† ì§„í–‰
                    }
                };

                initFirebase();
            }, []);

            return { firebase, user, isInitialized };
        };

        // Web Audio ê´€ë¦¬ í›…
        const useAudio = () => {
            const audioContextRef = useRef(null);
            const bgmOscillatorRef = useRef(null);
            const [audioInitialized, setAudioInitialized] = useState(false);
            const [isBGMPlaying, setIsBGMPlaying] = useState(false);

            const initializeAudio = useCallback(() => {
                if (audioInitialized) return;
                
                try {
                    audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
                    setAudioInitialized(true);
                } catch (error) {
                    console.error('Audio Context ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                }
            }, [audioInitialized]);

            const playBGM = useCallback(async () => {
                if (!audioContextRef.current || isBGMPlaying) return;

                try {
                    if (audioContextRef.current.state === 'suspended') {
                        await audioContextRef.current.resume();
                    }

                    setIsBGMPlaying(true);

                    const notes = [261.63, 329.63, 392.00, 523.25]; // C4, E4, G4, C5
                    let noteIndex = 0;
                    const noteDuration = 1.2;

                    const playNote = () => {
                        if (!audioContextRef.current || !isBGMPlaying) return;

                        const oscillator = audioContextRef.current.createOscillator();
                        const gainNode = audioContextRef.current.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContextRef.current.destination);
                        
                        oscillator.frequency.setValueAtTime(notes[noteIndex], audioContextRef.current.currentTime);
                        oscillator.type = 'sine';
                        
                        gainNode.gain.setValueAtTime(0, audioContextRef.current.currentTime);
                        gainNode.gain.linearRampToValueAtTime(0.03, audioContextRef.current.currentTime + 0.1);
                        gainNode.gain.linearRampToValueAtTime(0.03, audioContextRef.current.currentTime + noteDuration - 0.1);
                        gainNode.gain.linearRampToValueAtTime(0, audioContextRef.current.currentTime + noteDuration);
                        
                        oscillator.start(audioContextRef.current.currentTime);
                        oscillator.stop(audioContextRef.current.currentTime + noteDuration);
                        
                        noteIndex = (noteIndex + 1) % notes.length;
                        
                        setTimeout(() => {
                            if (isBGMPlaying) {
                                playNote();
                            }
                        }, noteDuration * 1000);
                    };

                    playNote();
                    
                } catch (error) {
                    console.error('BGM ì¬ìƒ ì‹¤íŒ¨:', error);
                }
            }, [isBGMPlaying]);

            const stopBGM = useCallback(() => {
                setIsBGMPlaying(false);
                if (bgmOscillatorRef.current) {
                    try {
                        bgmOscillatorRef.current.stop();
                        bgmOscillatorRef.current = null;
                    } catch (error) {
                        console.error('BGM ì •ì§€ ì‹¤íŒ¨:', error);
                    }
                }
            }, []);

            const playSound = useCallback((type) => {
                if (!audioContextRef.current) return;

                try {
                    const oscillator = audioContextRef.current.createOscillator();
                    const gainNode = audioContextRef.current.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContextRef.current.destination);
                    
                    switch (type) {
                        case 'explosion':
                            oscillator.frequency.setValueAtTime(150, audioContextRef.current.currentTime);
                            oscillator.frequency.exponentialRampToValueAtTime(50, audioContextRef.current.currentTime + 0.5);
                            gainNode.gain.setValueAtTime(0.2, audioContextRef.current.currentTime);
                            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContextRef.current.currentTime + 0.5);
                            oscillator.start();
                            oscillator.stop(audioContextRef.current.currentTime + 0.5);
                            break;
                        case 'gem':
                            oscillator.frequency.setValueAtTime(800, audioContextRef.current.currentTime);
                            oscillator.frequency.exponentialRampToValueAtTime(1200, audioContextRef.current.currentTime + 0.2);
                            gainNode.gain.setValueAtTime(0.1, audioContextRef.current.currentTime);
                            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContextRef.current.currentTime + 0.2);
                            oscillator.start();
                            oscillator.stop(audioContextRef.current.currentTime + 0.2);
                            break;
                        case 'correct':
                            oscillator.frequency.setValueAtTime(523.25, audioContextRef.current.currentTime);
                            oscillator.frequency.setValueAtTime(659.25, audioContextRef.current.currentTime + 0.1);
                            gainNode.gain.setValueAtTime(0.1, audioContextRef.current.currentTime);
                            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContextRef.current.currentTime + 0.3);
                            oscillator.start();
                            oscillator.stop(audioContextRef.current.currentTime + 0.3);
                            break;
                    }
                } catch (error) {
                    console.error('íš¨ê³¼ìŒ ì¬ìƒ ì‹¤íŒ¨:', error);
                }
            }, []);

            return { initializeAudio, playBGM, stopBGM, playSound, audioInitialized };
        };

        // ë©”í…Œì˜¤ ê²Œì„ ì»´í¬ë„ŒíŠ¸
        const MeteorGameHard = ({ skills, onGameEnd, onScoreUpdate, onCoinsUpdate, startLevel = 1 }) => {
            const canvasRef = useRef(null);
            const gameLoopRef = useRef(null);
            const keysRef = useRef({ left: false, right: false });

            // ğŸš€ ì´ë¯¸ì§€ ì°¸ì¡° ì„ ì–¸ ì¶”ê°€!
            const spaceshipImageRef = useRef(null);
            const meteorImageRef = useRef(null);  // âœ… ì¶”ê°€!

            // ğŸµ ë°°ê²½ìŒì•… ì°¸ì¡° ì¶”ê°€
            const bgmAudioRef = useRef(null);

            // ğŸš€ ì´ë¯¸ì§€ ë¡œë“œ ì¶”ê°€
            useEffect(() => {
                // HTMLì—ì„œ ì´ë¯¸ì§€ ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
                const img = document.getElementById('spaceship-img');
                
                if (img && img.complete) {
                    // ì´ë¯¸ì§€ê°€ ì´ë¯¸ ë¡œë“œëœ ê²½ìš°
                    spaceshipImageRef.current = img;
                    console.log('âœ… ìš°ì£¼ì„  ì´ë¯¸ì§€ ë¡œë“œ ì„±ê³µ!');
                } else if (img) {
                    // ì´ë¯¸ì§€ê°€ ì•„ì§ ë¡œë“œ ì¤‘ì¸ ê²½ìš°
                    img.onload = () => {
                        spaceshipImageRef.current = img;
                        console.log('âœ… ìš°ì£¼ì„  ì´ë¯¸ì§€ ë¡œë“œ ì„±ê³µ!');
                    };
                    img.onerror = () => {
                        console.error('âŒ ìš°ì£¼ì„  ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨');
                    };
                }
                
                // âœ… ë©”í…Œì˜¤ ì´ë¯¸ì§€ ë¡œë“œ ì¶”ê°€
                const meteorImg = document.getElementById('meteor-img');
                if (meteorImg && meteorImg.complete) {
                    meteorImageRef.current = meteorImg;
                    console.log('âœ… ë©”í…Œì˜¤ ì´ë¯¸ì§€ ë¡œë“œ ì„±ê³µ!');
                } else if (meteorImg) {
                    meteorImg.onload = () => {
                        meteorImageRef.current = meteorImg;
                        console.log('âœ… ë©”í…Œì˜¤ ì´ë¯¸ì§€ ë¡œë“œ ì„±ê³µ!');
                    };
                    meteorImg.onerror = () => {
                        console.error('âŒ ë©”í…Œì˜¤ ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨');
                    };
                }


                // ğŸµ ë°°ê²½ìŒì•… ë¡œë“œ
                const bgm = document.getElementById('bgm-audio');
                if (bgm) {
                    bgmAudioRef.current = bgm;
                    bgm.volume = 0.3; // ë³¼ë¥¨ 30% (0.0 ~ 1.0)
                    console.log('âœ… ë°°ê²½ìŒì•… ë¡œë“œ ì„±ê³µ!');
                } else {
                    console.error('âŒ bgm-audio ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                }

                // âœ…âœ…âœ… ì—¬ê¸°ì— 6ë‹¨ê³„ ì¶”ê°€! âœ…âœ…âœ…
                // ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸ ì‹œ ìŒì•… ì •ì§€
                return () => {
                    if (bgmAudioRef.current) {
                        bgmAudioRef.current.pause();
                        bgmAudioRef.current.currentTime = 0;
                    }
                };
            }, []);


            const [gameStats, setGameStats] = useState({
                level: 1,
                score: 0,
                lives: 1,
                timeLeft: 20
            });
            const [isRunning, setIsRunning] = useState(false);
            const runningRef = useRef(false);
            const [levelUpNotification, setLevelUpNotification] = useState({ isVisible: false, level: 0, animationPhase: 'enter' });
            
            // ê²Œì„ ê°ì²´ë“¤
            const gameObjectsRef = useRef({
                player: { x: 185, y: 450, width: 30, height: 30 },
                meteors: [],
                gems: [],
                hearts: [],
                shields: [],
                stars: []
            });

            const gameTimersRef = useRef({
                meteorTimer: 0,
                gemTimer: 0,
                heartTimer: 0,
                shieldTimer: 0,
                levelTimer: 0,
                survivalTimer: 0,
                lastTime: 0
            });

            const playerEffectsRef = useRef({
                hitInvincible: false,
                hitInvincibleTime: 0,
                shieldInvincible: false,
                shieldInvincibleTime: 0
            });

            const { playSound } = useAudio();

            // ê²Œì„ ì‹œì‘
            const startGame = useCallback(() => {
                setIsRunning(true);
                runningRef.current = true;

                // ğŸµ ë°°ê²½ìŒì•… ì¬ìƒ
                if (bgmAudioRef.current) {
                    bgmAudioRef.current.currentTime = 0; // ì²˜ìŒë¶€í„° ì¬ìƒ
                    bgmAudioRef.current.play().catch(error => {
                        console.log('ë°°ê²½ìŒì•… ìë™ ì¬ìƒ ì‹¤íŒ¨ (ë¸Œë¼ìš°ì € ì •ì±…):', error);
                    });
                }
                
                const initialStats = {
                    level: startLevel,
                    score: 0,
                    lives: 3 + skills.extraLife, // ê¸°ë³¸ ìƒëª… 2ê°œ
                    timeLeft: 20
                };
                setGameStats(initialStats);

                // ê²Œì„ ê°ì²´ ì´ˆê¸°í™”
                gameObjectsRef.current = {
                    player: { x: 185, y: 450, width: 30, height: 30 },
                    meteors: [],
                    gems: [],
                    hearts: [],
                    shields: [],
                    stars: Array.from({ length: 50 }, () => ({
                        x: Math.random() * 400,
                        y: Math.random() * 500,
                        size: Math.random() * 2 + 1
                    }))
                };

                gameTimersRef.current = {
                    meteorTimer: 0,
                    gemTimer: 0,
                    heartTimer: 0,
                    shieldTimer: 0,
                    levelTimer: 0,
                    survivalTimer: 0,
                    lastTime: performance.now()
                };

                playerEffectsRef.current = {
                    hitInvincible: false,
                    hitInvincibleTime: 0,
                    shieldInvincible: false,
                    shieldInvincibleTime: 0
                };

                // Canvas ì„¤ì •
                const canvas = canvasRef.current;
                if (canvas) {
                    canvas.width = 400;
                    canvas.height = 500;
                }

                // ê²Œì„ ë£¨í”„ ì‹œì‘
                requestAnimationFrame(gameLoop);
            }, [skills.extraLife]);

            // ê²Œì„ ë£¨í”„
            const gameLoop = useCallback((currentTime) => {
                if (!runningRef.current) return;

                const canvas = canvasRef.current;
                if (!canvas) return;

                const ctx = canvas.getContext('2d');
                const deltaTime = currentTime - gameTimersRef.current.lastTime;
                gameTimersRef.current.lastTime = currentTime;

                updateGame(deltaTime);
                drawGame(ctx);

                gameLoopRef.current = requestAnimationFrame(gameLoop);
            }, []);

            // ê²Œì„ ë¡œì§ ì—…ë°ì´íŠ¸
            const updateGame = useCallback((deltaTime) => {
                // ë¬´ì  íš¨ê³¼ ì—…ë°ì´íŠ¸
                if (playerEffectsRef.current.hitInvincible && playerEffectsRef.current.hitInvincibleTime > 0) {
                    playerEffectsRef.current.hitInvincibleTime -= deltaTime;
                    if (playerEffectsRef.current.hitInvincibleTime <= 0) {
                        playerEffectsRef.current.hitInvincible = false;
                        playerEffectsRef.current.hitInvincibleTime = 0;
                    }
                }
                
                if (playerEffectsRef.current.shieldInvincible && playerEffectsRef.current.shieldInvincibleTime > 0) {
                    playerEffectsRef.current.shieldInvincibleTime -= deltaTime;
                    if (playerEffectsRef.current.shieldInvincibleTime <= 0) {
                        playerEffectsRef.current.shieldInvincible = false;
                        playerEffectsRef.current.shieldInvincibleTime = 0;
                    }
                }

                // ìƒì¡´ ì ìˆ˜ ì—…ë°ì´íŠ¸ (1ì´ˆë§ˆë‹¤ 1ì )
                gameTimersRef.current.survivalTimer += deltaTime;
                if (gameTimersRef.current.survivalTimer >= 1000) {
                    gameTimersRef.current.survivalTimer -= 1000;
                    setGameStats(prev => ({ ...prev, score: prev.score + 1 }));
                    onScoreUpdate(1);
                }

                // ë ˆë²¨ íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸ (ë” ë¹ ë¥¸ ë ˆë²¨ì—…)
                gameTimersRef.current.levelTimer += deltaTime;
                const levelDuration = Math.max(12000, 20000 - gameStats.level * 800); // ë ˆë²¨ë‹¹ ì‹œê°„ ë‹¨ì¶•
                const timeLeft = Math.max(0, levelDuration - gameTimersRef.current.levelTimer);
                
                setGameStats(prev => {
                    const newStats = { ...prev, timeLeft: Math.ceil(timeLeft / 1000) };
                    
                    if (timeLeft <= 0) {
                        gameTimersRef.current.levelTimer = 0;
                        newStats.level = prev.level + 1;
                        const nextLevelDuration = Math.max(12000, 20000 - newStats.level * 800);
                        newStats.timeLeft = Math.ceil(nextLevelDuration / 1000);
                        
                        // ë ˆë²¨ì—… ì•Œë¦¼ í‘œì‹œ
                        setLevelUpNotification({ 
                            isVisible: true, 
                            level: newStats.level, 
                            animationPhase: 'enter' 
                        });
                        
                        // 2.5ì´ˆ í›„ ì‚¬ë¼ì§€ëŠ” ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
                        setTimeout(() => {
                            setLevelUpNotification(prev => ({ 
                                ...prev, 
                                animationPhase: 'exit' 
                            }));
                        }, 2200);
                        
                        // 3ì´ˆ í›„ ì™„ì „íˆ ì œê±°
                        setTimeout(() => {
                            setLevelUpNotification({ isVisible: false, level: 0, animationPhase: 'enter' });
                        }, 2500);
                    }
                    
                    return newStats;
                });

                // í”Œë ˆì´ì–´ ì´ë™
                const speed = 5 * (1 + skills.speedBoots * 0.075);
                if (keysRef.current.left && gameObjectsRef.current.player.x > 0) {
                    gameObjectsRef.current.player.x -= speed;
                }
                if (keysRef.current.right && gameObjectsRef.current.player.x < 370) {
                    gameObjectsRef.current.player.x += speed;
                }

                // ë©”í…Œì˜¤ ìƒì„±
                gameTimersRef.current.meteorTimer += deltaTime;
                
                // ë” ê°€íŒŒë¥¸ ë‚œì´ë„ ì¦ê°€ - ìƒì„± ë¹ˆë„ (ë” ë¹ ë¥´ê²Œ ìƒì„±)
                const meteorFreqArray = [240, 180, 120, 90, 70, 55, 45, 38, 32, 28];
                let meteorFreq;
                if (gameStats.level <= meteorFreqArray.length) {
                    meteorFreq = meteorFreqArray[gameStats.level - 1];
                } else {
                    // 10ë ˆë²¨ ì´í›„ ê³„ì† ê°ì†Œ (ìµœì†Œ 5msê¹Œì§€)
                    const extraLevels = gameStats.level - meteorFreqArray.length;
                    meteorFreq = Math.max(5, 28 - extraLevels * 2);
                }
                
                if (gameTimersRef.current.meteorTimer > meteorFreq) {
                    gameTimersRef.current.meteorTimer = 0;
                    
                    // ë” ê°€íŒŒë¥¸ ìƒì„±í™•ë¥  ì¦ê°€ (ë ˆë²¨ 1~10, ì´í›„ ê³„ì† ì¦ê°€)
                    const densityArray = [0.9, 1.8, 2.5, 3.2, 4.0, 4.8, 5.6, 6.4, 7.2, 8.0];
                    let baseDensity;
                    if (gameStats.level <= densityArray.length) {
                        baseDensity = densityArray[gameStats.level - 1];
                    } else {
                        // 10ë ˆë²¨ ì´í›„ ê³„ì† ì¦ê°€ (ìµœëŒ€ 15.0ê¹Œì§€)
                        const extraLevels = gameStats.level - densityArray.length;
                        baseDensity = 8.0 + extraLevels * 0.05;
                    }
                    const density = Math.max(0.2, baseDensity - skills.meteorSuppressor * 0.09);
                    
                    if (Math.random() < density) {
                        let meteorCount = 1;
                        
                        // ë” ê³µê²©ì ì¸ ë™ì‹œìƒì„± í™•ë¥  (10ë ˆë²¨ ì´í›„ì—ë„ ê³„ì† ì¦ê°€)
                        if (gameStats.level >= 2 && Math.random() < 0.5) meteorCount = 2;
                        if (gameStats.level >= 3 && Math.random() < 0.6) meteorCount = 3;
                        if (gameStats.level >= 4 && Math.random() < 0.5) meteorCount = 4;
                        if (gameStats.level >= 5 && Math.random() < 0.4) meteorCount = 5;
                        if (gameStats.level >= 6 && Math.random() < 0.3) meteorCount = 6;
                        if (gameStats.level >= 7 && Math.random() < 0.25) meteorCount = 7;
                        if (gameStats.level >= 8 && Math.random() < 0.2) meteorCount = 8;
                        if (gameStats.level >= 9 && Math.random() < 0.18) meteorCount = 9;
                        if (gameStats.level >= 10 && Math.random() < 0.16) meteorCount = 10;
                        if (gameStats.level >= 11 && Math.random() < 0.15) meteorCount = 11;
                        if (gameStats.level >= 12 && Math.random() < 0.14) meteorCount = 12;
                        if (gameStats.level >= 13 && Math.random() < 0.13) meteorCount = Math.min(15, 13);
                        if (gameStats.level >= 15 && Math.random() < 0.12) meteorCount = Math.min(20, gameStats.level);
                        
                        for (let i = 0; i < meteorCount; i++) {
                            // ë” ê°€íŒŒë¥¸ ë‚™í•˜ì†ë„ ì¦ê°€ (ë ˆë²¨ 1~10, ì´í›„ ê³„ì† ì¦ê°€)
                            const speedArray = [4.0, 8.5, 12.5, 17.0, 22.0, 27.5, 33.5, 40.0, 47.0, 55.0];
                            let baseSpeed;
                            if (gameStats.level <= speedArray.length) {
                                baseSpeed = speedArray[gameStats.level - 1];
                            } else {
                                // 10ë ˆë²¨ ì´í›„ ê³„ì† ì¦ê°€ (ìµœëŒ€ 100.0ê¹Œì§€)
                                const extraLevels = gameStats.level - speedArray.length;
                                baseSpeed = 55.0 + extraLevels * 0.3;
                            }
                            const finalSpeed = Math.max(1, baseSpeed * Math.max(0.3, 1 - skills.slowField * 0.07));
                            
                            gameObjectsRef.current.meteors.push({
                                x: Math.random() * 370,
                                y: -30 - (i * 50),
                                speed: finalSpeed
                            });
                        }
                    }
                }

                // ë³´ì„ ìƒì„±
                gameTimersRef.current.gemTimer += deltaTime;
                if (gameTimersRef.current.gemTimer > 3000) {
                    gameTimersRef.current.gemTimer = 0;
                    const gemChance = 0.3 + skills.gemAmplifier * 0.05;
                    if (Math.random() < gemChance) {
                        gameObjectsRef.current.gems.push({
                            x: Math.random() * 370,
                            y: -30,
                            speed: 1.5
                        });
                    }
                }

                // í•˜íŠ¸ ìƒì„± (ìƒëª… íšŒë³µ)
                gameTimersRef.current.heartTimer += deltaTime;
                if (gameTimersRef.current.heartTimer > 8000) { // 8ì´ˆë§ˆë‹¤ ì²´í¬
                    gameTimersRef.current.heartTimer = 0;
                    if (Math.random() < 0.25) { // 25% í™•ë¥ 
                        gameObjectsRef.current.hearts.push({
                            x: Math.random() * 370,
                            y: -30,
                            speed: 1.2
                        });
                    }
                }

                // ë¬´ì  ì‹¤ë“œ ìƒì„±
                gameTimersRef.current.shieldTimer += deltaTime;
                if (gameTimersRef.current.shieldTimer > 10000) { // 10ì´ˆë§ˆë‹¤ ì²´í¬
                    gameTimersRef.current.shieldTimer = 0;
                    if (Math.random() < 0.35) { // 35% í™•ë¥ 
                        gameObjectsRef.current.shields.push({
                            x: Math.random() * 370,
                            y: -30,
                            speed: 1.3
                        });
                    }
                }

                // ë©”í…Œì˜¤ ì—…ë°ì´íŠ¸ ë° ì¶©ëŒ ê²€ì‚¬
                gameObjectsRef.current.meteors = gameObjectsRef.current.meteors.filter(meteor => {
                    meteor.y += meteor.speed;

                    // ì¶©ëŒ ê²€ì‚¬ (ë¬´ì  ìƒíƒœê°€ ì•„ë‹ ë•Œë§Œ)
                    if (!playerEffectsRef.current.hitInvincible && !playerEffectsRef.current.shieldInvincible) {
                        const hitboxSize = skills.smallHitbox ? 24 : 36;
                        const playerCenterX = gameObjectsRef.current.player.x + 18;
                        const playerCenterY = gameObjectsRef.current.player.y + 18;
                        
                        if (meteor.x < playerCenterX + hitboxSize/2 && 
                            meteor.x + 30 > playerCenterX - hitboxSize/2 &&
                            meteor.y < playerCenterY + hitboxSize/2 && 
                            meteor.y + 30 > playerCenterY - hitboxSize/2) {
                            
                            playSound('explosion');
                            
                            // í”¼ê²© í›„ ë¬´ì  íš¨ê³¼ í™œì„±í™” (1ì´ˆê°„)
                            playerEffectsRef.current.hitInvincible = true;
                            playerEffectsRef.current.hitInvincibleTime = 1000;
                            
                            // ìƒëª…ë ¥ ê°ì†Œ ì²˜ë¦¬
                            setGameStats(prev => {
                                const newLives = prev.lives - 1;
                                const newStats = { ...prev, lives: newLives };
                                
                                // ê²Œì„ ì˜¤ë²„ ì²´í¬
                                if (newLives <= 0) {
                                    setTimeout(() => {
                                        runningRef.current = false;
                                        setIsRunning(false);

                                        // ğŸµ ë°°ê²½ìŒì•… ì •ì§€
                                        if (bgmAudioRef.current) {
                                            bgmAudioRef.current.pause();
                                            bgmAudioRef.current.currentTime = 0; // ì²˜ìŒìœ¼ë¡œ ë˜ëŒë¦¬ê¸°
                                        }
                                        onGameEnd(prev.level, prev.score);
                                    }, 100);
                                }
                                
                                return newStats;
                            });
                            
                            return false; // ë©”í…Œì˜¤ ì œê±°
                        }
                    }

                    return meteor.y < 500;
                });

                // ë³´ì„ ì—…ë°ì´íŠ¸ ë° ì¶©ëŒ ê²€ì‚¬
                gameObjectsRef.current.gems = gameObjectsRef.current.gems.filter(gem => {
                    gem.y += gem.speed;

                    // ìì„ íš¨ê³¼
                    if (skills.gemMagnet) {
                        const dx = gameObjectsRef.current.player.x + 15 - (gem.x + 8);
                        const dy = gameObjectsRef.current.player.y + 15 - (gem.y + 8);
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < 80) {
                            gem.x += dx * 0.1;
                            gem.y += dy * 0.1;
                        }
                    }

                    // ì¶©ëŒ ê²€ì‚¬
                    if (gem.x < gameObjectsRef.current.player.x + 30 && 
                        gem.x + 16 > gameObjectsRef.current.player.x &&
                        gem.y < gameObjectsRef.current.player.y + 30 && 
                        gem.y + 16 > gameObjectsRef.current.player.y) {
                        
                        playSound('gem');
                        
                        const gemScore = skills.gemScoreAmp ? 200 : 100;
                        const gemCoins = skills.gemScoreAmp ? 4 : 2;
                        
                        setGameStats(prev => ({ ...prev, score: prev.score + gemScore }));
                        onScoreUpdate(gemScore);
                        onCoinsUpdate(gemCoins);
                        
                        return false;
                    }

                    return gem.y < 500;
                });

                // í•˜íŠ¸ ì—…ë°ì´íŠ¸ ë° ì¶©ëŒ ê²€ì‚¬
                gameObjectsRef.current.hearts = gameObjectsRef.current.hearts.filter(heart => {
                    heart.y += heart.speed;

                    // ì¶©ëŒ ê²€ì‚¬
                    if (heart.x < gameObjectsRef.current.player.x + 30 && 
                        heart.x + 20 > gameObjectsRef.current.player.x &&
                        heart.y < gameObjectsRef.current.player.y + 30 && 
                        heart.y + 20 > gameObjectsRef.current.player.y) {
                        
                        playSound('gem'); // í•˜íŠ¸ íšë“ ì†Œë¦¬
                        
                        setGameStats(prev => ({ ...prev, lives: prev.lives + 1 }));
                        
                        return false;
                    }

                    return heart.y < 500;
                });

                // ì‹¤ë“œ ì—…ë°ì´íŠ¸ ë° ì¶©ëŒ ê²€ì‚¬
                gameObjectsRef.current.shields = gameObjectsRef.current.shields.filter(shield => {
                    shield.y += shield.speed;

                    // ì¶©ëŒ ê²€ì‚¬
                    if (shield.x < gameObjectsRef.current.player.x + 30 && 
                        shield.x + 20 > gameObjectsRef.current.player.x &&
                        shield.y < gameObjectsRef.current.player.y + 30 && 
                        shield.y + 20 > gameObjectsRef.current.player.y) {
                        
                        playSound('correct'); // ì‹¤ë“œ íšë“ ì†Œë¦¬
                        
                        playerEffectsRef.current.shieldInvincible = true;
                        playerEffectsRef.current.shieldInvincibleTime = 4000; // 4ì´ˆê°„ ë¬´ì 
                        
                        return false;
                    }

                    return shield.y < 500;
                });
            }, [gameStats.level, skills, playSound, onGameEnd, onScoreUpdate, onCoinsUpdate]);

            // í™”ë©´ ê·¸ë¦¬ê¸°
            const drawGame = useCallback((ctx) => {
                // ë°°ê²½ ê·¸ë¦¬ê¸°
                ctx.fillStyle = '#000011';
                ctx.fillRect(0, 0, 400, 500);

                // ë³„ ê·¸ë¦¬ê¸°
                ctx.fillStyle = 'white';
                gameObjectsRef.current.stars.forEach(star => {
                    ctx.beginPath();
                    ctx.arc(star.x, star.y, star.size / 2, 0, Math.PI * 2);
                    ctx.fill();
                });

                // ë©”í…Œì˜¤ ê·¸ë¦¬ê¸° (ì´ëª¨ì§€ë§Œ ì‚¬ìš©)
                gameObjectsRef.current.meteors.forEach(meteor => {
                    if (meteorImageRef.current) {
                        // ì´ë¯¸ì§€ ì‚¬ìš© (40Ã—40 í¬ê¸°ë¡œ ì¡°ê¸ˆ í¬ê²Œ)
                        ctx.drawImage(meteorImageRef.current, meteor.x - 5, meteor.y, 30, 30);
                    } else {
                        // í´ë°±: ì´ëª¨ì§€
                        ctx.font = '30px Arial';
                        ctx.fillText('â˜„ï¸', meteor.x, meteor.y + 25);
                    }
                });

                // ë³´ì„ ê·¸ë¦¬ê¸° (ì´ëª¨ì§€ë§Œ ì‚¬ìš©)
                gameObjectsRef.current.gems.forEach(gem => {
                    ctx.font = '24px Arial';
                    ctx.fillText('ğŸ’', gem.x, gem.y + 20);
                });

                // í•˜íŠ¸ ê·¸ë¦¬ê¸°
                gameObjectsRef.current.hearts.forEach(heart => {
                    ctx.font = '24px Arial';
                    ctx.fillText('ğŸ’–', heart.x, heart.y + 20);
                });

                // ì‹¤ë“œ ê·¸ë¦¬ê¸°
                gameObjectsRef.current.shields.forEach(shield => {
                    ctx.font = '24px Arial';
                    ctx.fillText('ğŸ›¡ï¸', shield.x, shield.y + 20);
                });

                // í”Œë ˆì´ì–´ ê·¸ë¦¬ê¸° (ì´ëª¨ì§€ë§Œ ì‚¬ìš©)
                const player = gameObjectsRef.current.player;
                ctx.font = '32px Arial';
                
                // ì‹¤ë“œ ë¬´ì  ìƒíƒœì¼ ë•Œ íŠ¹ë³„í•œ íš¨ê³¼
                if (playerEffectsRef.current.shieldInvincible) {
                    // ì‹¤ë“œ ë°°ê²½ ì›í˜•
                    const time = Date.now() / 100;
                    const radius = 30 + Math.sin(time) * 3;
                    
                    // ë°˜íˆ¬ëª… ì‹¤ë“œ ë°°ê²½
                    ctx.fillStyle = `rgba(0, 200, 255, ${0.3 + Math.sin(time * 2) * 0.1})`;
                    ctx.beginPath();
                    ctx.arc(player.x + 15, player.y + 15, radius, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // ì‹¤ë“œ í…Œë‘ë¦¬ íš¨ê³¼
                    ctx.strokeStyle = `rgba(100, 255, 255, ${0.8 + Math.sin(time * 3) * 0.2})`;
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.arc(player.x + 15, player.y + 15, radius, 0, Math.PI * 2);
                    ctx.stroke();
                    
                    // ë‚´ë¶€ ì‹¤ë“œ ë§
                    ctx.strokeStyle = `rgba(255, 255, 255, ${0.6 + Math.sin(time * 4) * 0.2})`;
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(player.x + 15, player.y + 15, radius - 10, 0, Math.PI * 2);
                    ctx.stroke();
                    
                    // ì‹¤ë“œ ì´ëª¨ì§€ ì˜¤ë²„ë ˆì´
                    ctx.font = '60px Arial';
                    ctx.globalAlpha = 0.4 + Math.sin(time * 2) * 0.2;
                    ctx.fillText('ğŸ›¡ï¸', player.x - 15, player.y + 35);
                    ctx.globalAlpha = 1.0;
                    ctx.font = '32px Arial';
                }

                // ìš°ì£¼ì„  ì´ë¯¸ì§€ ë˜ëŠ” ì´ëª¨ì§€ ê·¸ë¦¬ê¸°
                if (spaceshipImageRef.current) {
                    ctx.drawImage(spaceshipImageRef.current, player.x, player.y - 5, 40, 40);
                } else {
                    ctx.font = '32px Arial';
                    ctx.fillText('ğŸš€', player.x, player.y + 25);
                }
                
                ctx.globalAlpha = 1.0; // íˆ¬ëª…ë„ ë¦¬ì…‹

                // ì‘ì€ íˆíŠ¸ë°•ìŠ¤ í‘œì‹œ (ë””ë²„ê·¸ìš©, ìŠ¤í‚¬ ë³´ìœ  ì‹œ)
                if (skills.smallHitbox) {
                    ctx.strokeStyle = 'rgba(255, 255, 0, 0.3)';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(player.x + 6, player.y + 6, 18, 18);
                }


            }, [skills.smallHitbox]);

            // í‚¤ë³´ë“œ ì´ë²¤íŠ¸
            useEffect(() => {
                const handleKeyDown = (e) => {
                    if (e.key === 'ArrowLeft') keysRef.current.left = true;
                    if (e.key === 'ArrowRight') keysRef.current.right = true;
                };
                
                const handleKeyUp = (e) => {
                    if (e.key === 'ArrowLeft') keysRef.current.left = false;
                    if (e.key === 'ArrowRight') keysRef.current.right = false;
                };
                
                window.addEventListener('keydown', handleKeyDown);
                window.addEventListener('keyup', handleKeyUp);
                
                return () => {
                    window.removeEventListener('keydown', handleKeyDown);
                    window.removeEventListener('keyup', handleKeyUp);
                };
            }, []);

            // ì»´í¬ë„ŒíŠ¸ ì •ë¦¬
            useEffect(() => {
                return () => {
                    if (gameLoopRef.current) {
                        cancelAnimationFrame(gameLoopRef.current);
                    }
                    runningRef.current = false;
                };
            }, []);

            // ê²Œì„ ì‹œì‘ (ë§ˆìš´íŠ¸ ì‹œ)
            useEffect(() => {
                startGame();
            }, [startGame]);

            return (
                <div className="text-center">
                    <div className="mb-4">
                        {/* ì²« ë²ˆì§¸ ì¤„: ë ˆë²¨, ì ìˆ˜, ì‹œê°„ */}
                        <div className="flex justify-center gap-6 mb-2 text-lg">
                            <span>ë ˆë²¨: {gameStats.level}</span>
                            <span>ì ìˆ˜: {gameStats.score}</span>
                            <span>ì‹œê°„: {gameStats.timeLeft}s</span>
                        </div>
                        {/* ë‘ ë²ˆì§¸ ì¤„: ìƒëª…, ì‹¤ë“œ (ê³ ì • ë†’ì´) */}
                        <div className="flex justify-center gap-6 text-lg h-6 items-center">
                            <span>ìƒëª…: {'ğŸ’–'.repeat(Math.max(0, gameStats.lives))}</span>
                            {playerEffectsRef.current.shieldInvincible && playerEffectsRef.current.shieldInvincibleTime > 0 && (
                                <span className="text-blue-400 font-bold">
                                    ğŸ›¡ï¸ ì‹¤ë“œ {Math.ceil(playerEffectsRef.current.shieldInvincibleTime / 1000)}s
                                </span>
                            )}
                        </div>
                    </div>
                    
                    <div className="relative inline-block">
                        <canvas
                            ref={canvasRef}
                            className="border-2 border-gray-600 rounded-lg mx-auto block game-canvas"
                            width={400}
                            height={500}
                        />
                        
                        {/* ë ˆë²¨ì—… ì•Œë¦¼ ì˜¤ë²„ë ˆì´ */}
                        {levelUpNotification.isVisible && (
                            <div className={`absolute top-4 left-1/2 transform -translate-x-1/2 z-50 transition-all duration-500 ${
                                levelUpNotification.animationPhase === 'enter' 
                                    ? 'scale-110 opacity-100 animate-pulse' 
                                    : 'scale-100 opacity-0'
                            }`}>
                                <div className="text-center">
                                    <div className="text-2xl font-bold mb-1 animate-bounce text-yellow-300 drop-shadow-lg" style={{textShadow: '2px 2px 4px rgba(0,0,0,0.8)'}}>
                                        ğŸ‰ ë ˆë²¨ {levelUpNotification.level}! ğŸ‰
                                    </div>
                                    <div className="text-lg font-bold text-yellow-200 drop-shadow-lg" style={{textShadow: '2px 2px 4px rgba(0,0,0,0.8)'}}>
                                        ë„ë‹¬!
                                    </div>
                                    <div className="flex justify-center gap-1 mt-1">
                                        <span className="text-lg animate-spin">â­</span>
                                        <span className="text-lg animate-pulse">âœ¨</span>
                                        <span className="text-lg animate-bounce">ğŸŒŸ</span>
                                        <span className="text-lg animate-pulse">âœ¨</span>
                                        <span className="text-lg animate-spin">â­</span>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                    
                    <div className="mt-4 flex justify-center gap-6">
                        <button 
                            onMouseDown={() => keysRef.current.left = true}
                            onMouseUp={() => keysRef.current.left = false}
                            onTouchStart={(e) => {
                                e.preventDefault();
                                keysRef.current.left = true;
                            }}
                            onTouchEnd={(e) => {
                                e.preventDefault();
                                keysRef.current.left = false;
                            }}
                            className="bg-blue-600 hover:bg-blue-700 px-12 py-6 rounded-lg select-none font-bold text-xl transition-colors"
                        >
                            â† ì™¼ìª½
                        </button>
                        <button 
                            onMouseDown={() => keysRef.current.right = true}
                            onMouseUp={() => keysRef.current.right = false}
                            onTouchStart={(e) => {
                                e.preventDefault();
                                keysRef.current.right = true;
                            }}
                            onTouchEnd={(e) => {
                                e.preventDefault();
                                keysRef.current.right = false;
                            }}
                            className="bg-blue-600 hover:bg-blue-700 px-12 py-6 rounded-lg select-none font-bold text-xl transition-colors"
                        >
                            ì˜¤ë¥¸ìª½ â†’
                        </button>
                    </div>
                    <div className="text-sm text-gray-300 mt-2">
                        í‚¤ë³´ë“œ í™”ì‚´í‘œ í‚¤ ë˜ëŠ” ë²„íŠ¼ìœ¼ë¡œ ì¡°ì‘í•˜ì„¸ìš”
                    </div>
                </div>
            );
        };

        // ë©”ì¸ Division Quest ì»´í¬ë„ŒíŠ¸
        const DivisionQuest = () => {
            const { firebase, user, isInitialized } = useFirebase();
            const { initializeAudio, playBGM, stopBGM, playSound } = useAudio();
            
            // ë¡œì»¬ ì €ì¥ì†Œ í‚¤
            const STORAGE_KEYS = {
                coins: 'divisionQuest_coins',
                practiceStats: 'divisionQuest_practiceStats',
                skills: 'divisionQuest_skills',
                bestRecord: 'divisionQuest_bestRecord'
            };

            // ë¡œì»¬ ì €ì¥ì†Œì—ì„œ ë°ì´í„° ë¡œë“œ
            const loadFromStorage = (key, defaultValue) => {
                try {
                    const saved = localStorage.getItem(key);
                    return saved ? JSON.parse(saved) : defaultValue;
                } catch (error) {
                    console.error(`ë¡œì»¬ ì €ì¥ì†Œ ë¡œë“œ ì‹¤íŒ¨ (${key}):`, error);
                    return defaultValue;
                }
            };

            // ë¡œì»¬ ì €ì¥ì†Œì— ë°ì´í„° ì €ì¥
            const saveToStorage = (key, value) => {
                try {
                    localStorage.setItem(key, JSON.stringify(value));
                } catch (error) {
                    console.error(`ë¡œì»¬ ì €ì¥ì†Œ ì €ì¥ ì‹¤íŒ¨ (${key}):`, error);
                }
            };

            // ìƒíƒœ ê´€ë¦¬ (ë¡œì»¬ ì €ì¥ì†Œì—ì„œ ì´ˆê¸°ê°’ ë¡œë“œ)
            const [activeTab, setActiveTab] = useState('practice');
            const [coins, setCoins] = useState(() => loadFromStorage(STORAGE_KEYS.coins, 0));
            const grantInfiniteCoins = useCallback(() => {
                // 10ì–µ ì½”ì¸ìœ¼ë¡œ ì„¤ì •
                setCoins(1000000000); 
                alert('ğŸ’¸ 10ì–µ ì½”ì¸ì´ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤!'); 
            }, [setCoins]);
            const [practiceStats, setPracticeStats] = useState(() => loadFromStorage(STORAGE_KEYS.practiceStats, {
                totalProblems: 0,
                correctAnswers: 0,
                streak: 0
            }));
            const [currentProblem, setCurrentProblem] = useState(null);
            const [userAnswer, setUserAnswer] = useState('');
            const [skills, setSkills] = useState(() => loadFromStorage(STORAGE_KEYS.skills, {
                speedBoots: 0,
                slowField: 0,
                meteorSuppressor: 0,
                gemAmplifier: 0,
                smallHitbox: false,
                gemMagnet: false,
                gemScoreAmp: false,
                extraLife: 0
            }));
            const [gameState, setGameState] = useState('menu');
            const [gameMode, setGameMode] = useState('normal'); // â† ì´ ì¤„ì„ ì¶”ê°€
            const [bestRecord, setBestRecord] = useState(() => loadFromStorage(STORAGE_KEYS.bestRecord, { level: 0, score: 0 }));
            const [showAdminConsole, setShowAdminConsole] = useState(false);

            // ì½”ì¸ ìƒíƒœ ë³€ê²½ ì‹œ ë¡œì»¬ ì €ì¥ì†Œì— ì €ì¥
            useEffect(() => {
                saveToStorage(STORAGE_KEYS.coins, coins);
            }, [coins]);

            // ì—°ìŠµ í†µê³„ ìƒíƒœ ë³€ê²½ ì‹œ ë¡œì»¬ ì €ì¥ì†Œì— ì €ì¥
            useEffect(() => {
                saveToStorage(STORAGE_KEYS.practiceStats, practiceStats);
            }, [practiceStats]);

            // ìŠ¤í‚¬ ìƒíƒœ ë³€ê²½ ì‹œ ë¡œì»¬ ì €ì¥ì†Œì— ì €ì¥
            useEffect(() => {
                saveToStorage(STORAGE_KEYS.skills, skills);
            }, [skills]);

            // ìµœê³  ê¸°ë¡ ìƒíƒœ ë³€ê²½ ì‹œ ë¡œì»¬ ì €ì¥ì†Œì— ì €ì¥
            useEffect(() => {
                saveToStorage(STORAGE_KEYS.bestRecord, bestRecord);
            }, [bestRecord]);

            // Firebase ìµœê³  ê¸°ë¡ ë¡œë“œ
            const loadBestRecord = useCallback(async () => {
                if (!firebase || !user) return;

                try {
                    const docRef = firebase.doc(firebase.firestore, `artifacts/${firebase.appId}/users/${user.uid}/game_records/best_score`);
                    const docSnap = await firebase.getDoc(docRef);
                    
                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        const cloudRecord = { 
                            level: data.level || 0, 
                            score: data.score || 0 
                        };
                        
                        // í´ë¼ìš°ë“œì™€ ë¡œì»¬ ê¸°ë¡ ì¤‘ ë” ë†’ì€ ê²ƒ ì‚¬ìš©
                        setBestRecord(prev => {
                            const finalRecord = {
                                level: Math.max(prev.level, cloudRecord.level),
                                score: Math.max(prev.score, cloudRecord.score)
                            };
                            
                            return finalRecord;
                        });
                    }
                } catch (error) {
                    console.error('ê¸°ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                }
            }, [firebase, user]);

            // ê¸°ë¡ ì €ì¥ (ë¡œì»¬ + í´ë¼ìš°ë“œ)
            const saveBestRecord = useCallback(async (level, score) => {
                const newLevel = Math.max(level, bestRecord.level);
                const newScore = Math.max(score, bestRecord.score);
                
                if (newLevel > bestRecord.level || newScore > bestRecord.score) {
                    const newRecord = { level: newLevel, score: newScore };
                    
                    // Firebaseì— ì €ì¥
                    if (firebase && user) {
                        try {
                            const docRef = firebase.doc(firebase.firestore, `artifacts/${firebase.appId}/users/${user.uid}/game_records/best_score`);
                            await firebase.setDoc(docRef, {
                                level: newLevel,
                                score: newScore,
                                timestamp: new Date()
                            });
                        } catch (error) {
                            console.error('í´ë¼ìš°ë“œ ì €ì¥ ì‹¤íŒ¨:', error);
                        }
                    }
                    
                    setBestRecord(newRecord);
                }
            }, [firebase, user, bestRecord]);

            // ê¸°ë¡ ë¦¬ì…‹
            const resetRecord = useCallback(async () => {
                const resetRecord = { level: 0, score: 0 };
                
                // Firebase ë¦¬ì…‹
                if (firebase && user) {
                    try {
                        const docRef = firebase.doc(firebase.firestore, `artifacts/${firebase.appId}/users/${user.uid}/game_records/best_score`);
                        await firebase.setDoc(docRef, {
                            level: 0,
                            score: 0,
                            timestamp: new Date()
                        });
                    } catch (error) {
                        console.error('í´ë¼ìš°ë“œ ë¦¬ì…‹ ì‹¤íŒ¨:', error);
                    }
                }
                
                setBestRecord(resetRecord);
            }, [firebase, user]);

            // ì‚¬ìš©ì ì¸ì¦ í›„ ë°ì´í„° ë¡œë“œ
            useEffect(() => {
                if (isInitialized && user) {
                    loadBestRecord();
                }
            }, [isInitialized, user, loadBestRecord]);

            // ë‚˜ëˆ—ì…ˆ ë¬¸ì œ ìƒì„±
            const generateProblem = useCallback(() => {
                const divisor = Math.floor(Math.random() * 9) + 2;
                const quotient = Math.floor(Math.random() * 20) + 1;
                const remainder = Math.floor(Math.random() * (divisor - 1));
                const dividend = divisor * quotient + remainder;
                
                setCurrentProblem({ dividend, divisor, quotient, remainder });
                setUserAnswer('');
            }, []);

            // ë‹µì•ˆ í™•ì¸
            const checkAnswer = useCallback(() => {
                if (!currentProblem || !userAnswer.trim()) return;
                
                const parts = userAnswer.split(',').map(s => s.trim());
                
                // ë‚˜ë¨¸ì§€ê°€ 0ì¸ ê²½ìš° ëª«ë§Œ ì…ë ¥í•´ë„ ì •ë‹µ ì²˜ë¦¬
                if (currentProblem.remainder === 0) {
                    if (parts.length === 1) {
                        const quotientAnswer = parseInt(parts[0]);
                        const isCorrect = quotientAnswer === currentProblem.quotient;
                        handleAnswerResult(isCorrect);
                        return;
                    } else if (parts.length === 2) {
                        const [quotientAnswer, remainderAnswer] = parts.map(s => parseInt(s));
                        const isCorrect = quotientAnswer === currentProblem.quotient && 
                                        (remainderAnswer === 0 || isNaN(remainderAnswer));
                        handleAnswerResult(isCorrect);
                        return;
                    }
                } else {
                    // ë‚˜ë¨¸ì§€ê°€ 0ì´ ì•„ë‹Œ ê²½ìš° ê¸°ì¡´ ë¡œì§
                    if (parts.length !== 2) return;
                    
                    const [quotientAnswer, remainderAnswer] = parts.map(s => parseInt(s));
                    const isCorrect = quotientAnswer === currentProblem.quotient && 
                                    remainderAnswer === currentProblem.remainder;
                    handleAnswerResult(isCorrect);
                    return;
                }
            }, [currentProblem, userAnswer, practiceStats.streak, playSound, generateProblem]);

            // ë‹µì•ˆ ê²°ê³¼ ì²˜ë¦¬ í•¨ìˆ˜

            const handleAnswerResult = useCallback((isCorrect) => {
    
                const currentStreak = practiceStats.streak;
                const newStreak = isCorrect ? currentStreak + 1 : 0; // ë‹¤ìŒ í„´ì— ì ìš©ë  streak ê°’

                setPracticeStats(prev => ({
                    totalProblems: prev.totalProblems + 1,
                    correctAnswers: prev.correctAnswers + (isCorrect ? 1 : 0),
                    // ê³„ì‚°ëœ newStreak ê°’ìœ¼ë¡œ ì—…ë°ì´íŠ¸
                    streak: newStreak
                }));
                
                if (isCorrect) {
                    playSound('correct');
                    
                    const baseCoins = 5;
                    // --- ğŸ‘‡ ì½”ì¸ íšë“ ë¡œì§ ìˆ˜ì • ğŸ‘‡ ---
                    let bonusCoins = 0;
                    
                    // ìƒˆë¡œìš´ ì—°ì† ì •ë‹µ íšŸìˆ˜ê°€ 3ì˜ ë°°ìˆ˜ì¼ ë•Œë§Œ 10 ì½”ì¸ ì§€ê¸‰ (3, 6, 9, 12... íšŒì°¨)
                    if (newStreak > 0 && newStreak % 3 === 0) {
                        bonusCoins = 10;
                    }
                    
                    const totalCoins = baseCoins + bonusCoins;
                    // --- ğŸ‘† ì½”ì¸ íšë“ ë¡œì§ ìˆ˜ì • ì™„ë£Œ ğŸ‘† ---

                    setCoins(prev => prev + totalCoins);
                    generateProblem();
                }
            }, [playSound, setPracticeStats, setCoins, generateProblem, practiceStats.streak]);

        



            // ìŠ¤í‚¬ êµ¬ë§¤
            const buySkill = useCallback((skillName, price) => {
                if (coins < price) return;
                
                setCoins(prev => prev - price);
                setSkills(prev => {
                    const newSkills = { ...prev };
                    if (typeof prev[skillName] === 'number') {
                        newSkills[skillName] = prev[skillName] + 1;
                    } else {
                        newSkills[skillName] = true;
                    }
                    return newSkills;
                });
            }, [coins]);

            // ê²Œì„ ì‹œì‘
            const startGame = useCallback((mode = 'normal') => {
                const cost = mode === 'hard' ? 20 : 10;
                
                // ì½”ì¸ ì°¨ê°
                setCoins(prev => prev - cost);
                setGameMode(mode);
                
                initializeAudio();
                playBGM();
                setGameState('playing');
            }, [initializeAudio, playBGM]);
            /* const startGame = useCallback(() => {
                // ì½”ì¸ 10ê°œ ì°¨ê°
                setCoins(prev => prev - 10);
                
                initializeAudio();
                playBGM();
                setGameState('playing');
            }, [initializeAudio, playBGM]); */

            // ê²Œì„ ê²°ê³¼ ìƒíƒœ ì¶”ê°€
            const [lastGameResult, setLastGameResult] = useState({ level: 0, score: 0 });

            // ê²Œì„ ì¢…ë£Œ
            const handleGameEnd = useCallback((level, score) => {
                stopBGM();
                
                // ì´ë²ˆ ê²Œì„ ê²°ê³¼ ì €ì¥
                setLastGameResult({ level, score });
                
                // ìµœê³  ê¸°ë¡ ì—…ë°ì´íŠ¸
                setBestRecord(prev => {
                    const newLevel = Math.max(level, prev.level);
                    const newScore = Math.max(score, prev.score);
                    
                    // Firebaseì— ì €ì¥
                    if (firebase && user && (newLevel > prev.level || newScore > prev.score)) {
                        const docRef = firebase.doc(firebase.firestore, `artifacts/${firebase.appId}/users/${user.uid}/game_records/best_score`);
                        firebase.setDoc(docRef, {
                            level: newLevel,
                            score: newScore,
                            timestamp: new Date()
                        }).catch(error => console.error('ê¸°ë¡ ì €ì¥ ì‹¤íŒ¨:', error));
                    }
                    
                    return { level: newLevel, score: newScore };
                });
                
                setGameState('gameOver');
            }, [stopBGM, firebase, user]);

            // ì ìˆ˜ ì—…ë°ì´íŠ¸
            const handleScoreUpdate = useCallback((points) => {
                // ì ìˆ˜ëŠ” ê²Œì„ ì»´í¬ë„ŒíŠ¸ì—ì„œ ê´€ë¦¬
            }, []);

            // ì½”ì¸ ì—…ë°ì´íŠ¸
            const handleCoinsUpdate = useCallback((coinAmount) => {
                setCoins(prev => prev + coinAmount);
            }, []);

            // ì²« ë¬¸ì œ ìƒì„±
            useEffect(() => {
                if (activeTab === 'practice' && !currentProblem) {
                    generateProblem();
                }
            }, [activeTab, currentProblem, generateProblem]);

            // ìŠ¤íƒ ê°€ëŠ¥í•œ ìŠ¤í‚¬ì˜ ìµœëŒ€ ë ˆë²¨ ìƒìˆ˜ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
            const MAX_STACKABLE_LEVEL = 10;

            // ìŠ¤í‚¬ ë°ì´í„°
            const skillsData = [ 
                // speedBoots, slowField, meteorSuppressor, gemAmplifier, extraLifeì— maxLevel ì†ì„±ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
                { key: 'speedBoots', name: 'ğŸš€ ìŠ¤í”¼ë“œ ë¶€ì¸ ', price: 25, desc: '+7.5% ì´ë™ ì†ë„', stackable: true, maxLevel: MAX_STACKABLE_LEVEL }, 
                { key: 'slowField', name: 'ğŸŒ€ ìŠ¬ë¡œìš° í•„ë“œ', price: 30, desc: `ë©”í…Œì˜¤ ë‚™í•˜ì†ë„ -7% (ëˆ„ì , ìµœëŒ€ Lv.${MAX_STACKABLE_LEVEL})`, stackable: true, maxLevel: MAX_STACKABLE_LEVEL }, 
                { key: 'meteorSuppressor', name: 'â˜‚ï¸ ë©”í…Œì˜¤ ì–µì œê¸°', price: 40, desc: `ë©”í…Œì˜¤ ë°€ë„ -9% (ëˆ„ì , ìµœëŒ€ Lv.${MAX_STACKABLE_LEVEL})`, stackable: true, maxLevel: MAX_STACKABLE_LEVEL }, 
                { key: 'gemAmplifier', name: 'ğŸ’ ë³´ì„ í™•ë¥  ì¦í­ê¸°', price: 30, desc: `+5% ë³´ì„ í™•ë¥  (ëˆ„ì , ìµœëŒ€ Lv.${MAX_STACKABLE_LEVEL})`, stackable: true, maxLevel: MAX_STACKABLE_LEVEL }, 
                { key: 'smallHitbox', name: 'ğŸ¤ ì‘ì€ íˆíŠ¸ë°•ìŠ¤', price: 50, desc: 'í”¼ê²© ë²”ìœ„ ëŒ€í­ ê°ì†Œ', stackable: false }, 
                { key: 'gemMagnet', name: 'ğŸ§² ë³´ì„ ìì„', price: 60, desc: 'ì£¼ë³€ ë³´ì„ ìë™ í¡ìˆ˜', stackable: false }, 
                { key: 'gemScoreAmp', name: 'ğŸ’° ë³´ì„ ì ìˆ˜ ì¦í­', price: 70, desc: 'ë³´ì„ íšë“ ì ìˆ˜/ì½”ì¸ 2ë°°', stackable: false }, 
                { key: 'extraLife', name: 'â¤ï¸ ì¶”ê°€ ìƒëª…', price: 100, desc: `ê¸°ë³¸ ìƒëª… +1 (ìµœëŒ€ Lv.${MAX_STACKABLE_LEVEL})`, stackable: true, maxLevel: MAX_STACKABLE_LEVEL },
            ];


            // íƒ€ì´í‹€ ê³„ì‚° (10ë ˆë²¨ê¹Œì§€ë§Œ)
            const getTitle = useCallback((level) => {
                if (level >= 20) return 'ì ˆëŒ€ì ì‹  ğŸ‘‘';
                if (level >= 19) return 'ë¹…ë±… ëª©ê²©ì';
                if (level >= 18) return 'ë‹¤ì¤‘ìš°ì£¼ ì—¬í–‰ì';
                if (level >= 17) return 'ìš°ì£¼ ì°½ì¡°ì';
                if (level >= 16) return 'ì´ˆì‹ ì„± ë§ˆìŠ¤í„°';
                if (level >= 15) return 'ì€í•˜ê³„ ì§€ë°°ì â­';
                if (level >= 14) return 'ì‹œê³µê°„ ìˆ˜í˜¸ì';
                if (level >= 13) return 'ë¸”ë™í™€ íƒí—˜ê°€';
                if (level >= 12) return 'ì„±ìš´ ì •ë³µì';
                if (level >= 11) return 'ì°¨ì› í•­í•´ì';
                if (level >= 10) return 'ì „ì„¤ì˜ í•­í•´ì ğŸ†';
                if (level >= 9) return 'ìš°ì£¼ ì œë…';
                if (level >= 8) return 'ì½”ìŠ¤ë¯¹ ì±”í”¼ì–¸';
                if (level >= 7) return 'ì„±ë‹¨ ê°œì²™ì';
                if (level >= 6) return 'ì€í•˜ ìˆ˜í˜¸ì';
                if (level >= 5) return 'ê¶¤ë„ ë¹„í–‰ì‚¬';
                if (level >= 4) return 'ìœ ì„± íšŒí”¼ì';
                if (level >= 3) return 'ê²¬ìŠµ ì¡°ì¢…ì‚¬';
                if (level >= 2) return 'ì´ˆë³´ ë¹„í–‰ì‚¬';
                return 'ì—°ìŠµìƒ';
            }, []);

            // ì¹­í˜¸ ëª©ë¡ (10ë ˆë²¨ê¹Œì§€ë§Œ)
            const titleList = [
                { level: 1, title: 'ì—°ìŠµìƒ' },
                { level: 2, title: 'ì´ˆë³´ ë¹„í–‰ì‚¬' },
                { level: 3, title: 'ê²¬ìŠµ ì¡°ì¢…ì‚¬' },
                { level: 4, title: 'ìœ ì„± íšŒí”¼ì' },
                { level: 5, title: 'ê¶¤ë„ ë¹„í–‰ì‚¬' },
                { level: 6, title: 'ì€í•˜ ìˆ˜í˜¸ì' },
                { level: 7, title: 'ì„±ë‹¨ ê°œì²™ì' },
                { level: 8, title: 'ì½”ìŠ¤ë¯¹ ì±”í”¼ì–¸' },
                { level: 9, title: 'ìš°ì£¼ ì œë…' },
                { level: 10, title: 'ì „ì„¤ì˜ í•­í•´ì ğŸ†' },
                { level: 11, title: 'ì°¨ì› í•­í•´ì' },
                { level: 12, title: 'ì„±ìš´ ì •ë³µì' },
                { level: 13, title: 'ë¸”ë™í™€ íƒí—˜ê°€' },
                { level: 14, title: 'ì‹œê³µê°„ ìˆ˜í˜¸ì' },
                { level: 15, title: 'ì€í•˜ê³„ ì§€ë°°ì â­' },
                { level: 16, title: 'ì´ˆì‹ ì„± ë§ˆìŠ¤í„°' },
                { level: 17, title: 'ìš°ì£¼ ì°½ì¡°ì' },
                { level: 18, title: 'ë‹¤ì¤‘ìš°ì£¼ ì—¬í–‰ì' },
                { level: 19, title: 'ë¹…ë±… ëª©ê²©ì' },
                { level: 20, title: 'ì ˆëŒ€ì ì‹  ğŸ‘‘' }
            ];

            // ê´€ë¦¬ì ì½˜ì†” ì ‘ê·¼ í•¨ìˆ˜
            const openAdminConsole = useCallback(() => {
                // ì¸ë¼ì¸ ëª¨ë‹¬ë¡œ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ë°›ê¸°
                const modalDiv = document.createElement('div');
                modalDiv.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.8);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                `;
                
                const modalContent = document.createElement('div');
                modalContent.style.cssText = `
                    background: #1f2937;
                    padding: 30px;
                    border-radius: 10px;
                    text-align: center;
                    color: white;
                    font-family: Arial, sans-serif;
                `;
                
                modalContent.innerHTML = `
                    <h3 style="margin-bottom: 20px; font-size: 20px;">ê´€ë¦¬ì ì½˜ì†” ì ‘ê·¼</h3>
                    <input type="password" id="adminPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" 
                           style="padding: 10px; margin-bottom: 20px; border-radius: 5px; border: none; width: 200px; text-align: center; font-size: 16px; color: black;">
                    <br>
                    <button id="confirmBtn" style="background: #3b82f6; color: white; padding: 10px 20px; border: none; border-radius: 5px; margin-right: 10px; cursor: pointer; font-size: 16px;">í™•ì¸</button>
                    <button id="cancelBtn" style="background: #6b7280; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;">ì·¨ì†Œ</button>
                `;
                
                modalDiv.appendChild(modalContent);
                document.body.appendChild(modalDiv);
                
                const passwordInput = document.getElementById('adminPassword');
                const confirmBtn = document.getElementById('confirmBtn');
                const cancelBtn = document.getElementById('cancelBtn');
                
                passwordInput.focus();
                
                const checkPassword = () => {
                    const password = passwordInput.value;
                    if (password === '1050') {
                        setShowAdminConsole(true);
                        document.body.removeChild(modalDiv);
                    } else {
                        passwordInput.value = '';
                        passwordInput.placeholder = 'ì˜ëª»ëœ ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤';
                        passwordInput.style.background = '#fee2e2';
                        setTimeout(() => {
                            passwordInput.style.background = 'white';
                            passwordInput.placeholder = 'ë¹„ë°€ë²ˆí˜¸ ì…ë ¥';
                        }, 1000);
                    }
                };
                
                const closeModal = () => {
                    document.body.removeChild(modalDiv);
                };
                
                confirmBtn.addEventListener('click', checkPassword);
                cancelBtn.addEventListener('click', closeModal);
                passwordInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') checkPassword();
                });
                modalDiv.addEventListener('click', (e) => {
                    if (e.target === modalDiv) closeModal();
                });
            }, []);

            // ê²Œì„ ì„¤ì • ê³„ì‚° í•¨ìˆ˜
            const getGameSettings = useCallback((level = 1) => {
                // ë©”í…Œì˜¤ ì„¤ì • - ë” ê°€íŒŒë¥¸ ë‚œì´ë„ ì¦ê°€
                const meteorFreqArray = [200, 160, 120, 90, 70, 55, 45, 38, 32, 28];
                const meteorFreq = meteorFreqArray[Math.min(level - 1, meteorFreqArray.length - 1)];
                
                const densityArray = [1.2, 1.8, 2.5, 3.2, 4.0, 4.8, 5.6, 6.4, 7.2, 8.0];
                const baseDensity = densityArray[Math.min(level - 1, densityArray.length - 1)];
                const meteorDensity = Math.max(0.2, baseDensity - skills.meteorSuppressor * 0.09);
                
                const speedArray = [5.0, 8.5, 12.5, 17.0, 22.0, 27.5, 33.5, 40.0, 47.0, 55.0];
                const baseSpeed = speedArray[Math.min(level - 1, speedArray.length - 1)];
                const meteorSpeed = Math.max(1, baseSpeed * Math.max(0.3, 1 - skills.slowField * 0.07));
                
                // í”Œë ˆì´ì–´ ì„¤ì •
                const playerSpeed = 5 * (1 + skills.speedBoots * 0.15);
                
                // ì•„ì´í…œ ì„¤ì •
                const gemChance = 0.3 + skills.gemAmplifier * 0.05;
                const heartChance = 0.25;
                const shieldChance = 0.35;
                
                // íˆíŠ¸ë°•ìŠ¤ ì„¤ì •
                const hitboxSize = skills.smallHitbox ? 18 : 30;
                
                return {
                    meteor: {
                        frequency: `${meteorFreq}ms`,
                        density: `${(meteorDensity * 100).toFixed(1)}%`,
                        speed: `${meteorSpeed.toFixed(2)} px/frame`,
                        hitChance: `${((30 * 30) / (hitboxSize * hitboxSize) * 100).toFixed(1)}%`
                    },
                    player: {
                        speed: `${playerSpeed.toFixed(2)} px/frame`,
                        hitboxSize: `${hitboxSize}x${hitboxSize} px`
                    },
                    items: {
                        gem: {
                            frequency: '3000ms',
                            chance: `${(gemChance * 100).toFixed(1)}%`,
                            speed: '1.5 px/frame'
                        },
                        heart: {
                            frequency: '8000ms',
                            chance: `${(heartChance * 100).toFixed(1)}%`,
                            speed: '1.2 px/frame'
                        },
                        shield: {
                            frequency: '10000ms',
                            chance: `${(shieldChance * 100).toFixed(1)}%`,
                            speed: '1.3 px/frame'
                        }
                    }
                };
            }, [skills]);

            // ëª¨ë“  ë°ì´í„° ë¦¬ì…‹ í•¨ìˆ˜
            const resetAllData = useCallback(() => {
                // ìƒíƒœ ë¦¬ì…‹
                setCoins(0);
                setPracticeStats({
                    totalProblems: 0,
                    correctAnswers: 0,
                    streak: 0
                });
                setSkills({
                    speedBoots: 0,
                    slowField: 0,
                    meteorSuppressor: 0,
                    gemAmplifier: 0,
                    smallHitbox: false,
                    gemMagnet: false,
                    gemScoreAmp: false,
                    extraLife: 0
                });
                setBestRecord({ level: 0, score: 0 });
                
                // ë¡œì»¬ ì €ì¥ì†Œ ë¦¬ì…‹
                Object.values(STORAGE_KEYS).forEach(key => {
                    localStorage.removeItem(key);
                });
                
                // Firebase ë¦¬ì…‹
                if (firebase && user) {
                    try {
                        const docRef = firebase.doc(firebase.firestore, `artifacts/${firebase.appId}/users/${user.uid}/game_records/best_score`);
                        firebase.setDoc(docRef, {
                            level: 0,
                            score: 0,
                            timestamp: new Date()
                        }).catch(error => console.error('í´ë¼ìš°ë“œ ë¦¬ì…‹ ì‹¤íŒ¨:', error));
                    } catch (error) {
                        console.error('í´ë¼ìš°ë“œ ë¦¬ì…‹ ì‹¤íŒ¨:', error);
                    }
                }
            }, [firebase, user]);

            if (!isInitialized) {
                return (
                    <div className="min-h-full bg-gradient-to-b from-purple-900 to-blue-900 text-white flex items-center justify-center">
                        <div className="text-center">
                            <div className="text-4xl mb-4">ğŸš€</div>
                            <div className="text-xl">Division Quest ë¡œë”© ì¤‘...</div>
                        </div>
                    </div>
                );
            }

            // ê´€ë¦¬ì ì½˜ì†” í™”ë©´
            if (showAdminConsole) {
                const currentSettings = getGameSettings(1);
                const level5Settings = getGameSettings(5);
                const level10Settings = getGameSettings(10);

                return (
                    <div className="min-h-full bg-gradient-to-b from-gray-900 to-black text-white">
                        <div className="container mx-auto px-4 py-6 max-w-6xl">
                            <div className="text-center mb-6">
                                <h1 className="text-4xl font-bold mb-2">ğŸ”§ ê´€ë¦¬ì ì½˜ì†”</h1>
                                <p className="text-gray-300">ê²Œì„ ì„¤ì • ë° ë°¸ëŸ°ìŠ¤ ì •ë³´</p>
                            </div>

                            {/* --- ğŸ‘‡ ì—¬ê¸°ì— ëˆ ë¬´í•œ ë²„íŠ¼ ì„¹ì…˜ì„ ì¶”ê°€í•©ë‹ˆë‹¤ ğŸ‘‡ --- */}
                            <div className="bg-black bg-opacity-50 rounded-lg p-6 mb-6">
                                <h2 className="text-2xl font-bold mb-4 text-center text-red-400">
                                    ğŸš¨ ë””ë²„ê·¸ ë„êµ¬
                                </h2>
                                <div className="space-y-4">
                                    <button
                                        // ì´ í•¨ìˆ˜ëŠ” 1ë‹¨ê³„ì—ì„œ DivisionQuest ë‚´ë¶€ì— ì •ì˜í•´ì•¼ í•©ë‹ˆë‹¤.
                                        onClick={() => {
                                            setCoins(1000000000); 
                                            alert('ğŸ’¸ 10ì–µ ì½”ì¸ì´ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤!'); 
                                        }}
                                        className="w-full bg-red-700 hover:bg-red-800 text-white font-bold py-3 rounded-lg transition-colors shadow-lg border-2 border-red-900"
                                    >
                                        ğŸ’¸ ëˆ ë¬´í•œ (10ì–µ ì½”ì¸ íšë“)
                                    </button>
                                </div>
                            </div>

                            <div className="grid gap-6 mb-6">
                                {/* ë ˆë²¨ë³„ ì„¤ì • ë¹„êµ */}
                                <div className="bg-black bg-opacity-50 rounded-lg p-6">
                                    <h2 className="text-2xl font-bold mb-4 text-center">ğŸ“Š ë ˆë²¨ë³„ ê²Œì„ ì„¤ì •</h2>
                                    
                                    <div className="grid md:grid-cols-3 gap-4">
                                        {[
                                            { level: 1, settings: currentSettings, title: 'ë ˆë²¨ 1 (ì‹œì‘)' },
                                            { level: 5, settings: level5Settings, title: 'ë ˆë²¨ 5 (ì¤‘ë°˜)' },
                                            { level: 10, settings: level10Settings, title: 'ë ˆë²¨ 10 (í›„ë°˜)' }
                                        ].map(({ level, settings, title }) => (
                                            <div key={level} className="bg-gray-800 rounded-lg p-4">
                                                <h3 className="text-lg font-bold mb-3 text-center text-yellow-400">{title}</h3>
                                                
                                                {/* ë©”í…Œì˜¤ ì„¤ì • */}
                                                <div className="mb-4">
                                                    <h4 className="font-bold text-red-400 mb-2">â˜„ï¸ ë©”í…Œì˜¤</h4>
                                                    <div className="text-sm space-y-1">
                                                        <div>ìƒì„± ë¹ˆë„: <span className="text-yellow-300">{settings.meteor.frequency}</span></div>
                                                        <div>ìƒì„± í™•ë¥ : <span className="text-yellow-300">{settings.meteor.density}</span></div>
                                                        <div>ë‚™í•˜ ì†ë„: <span className="text-yellow-300">{settings.meteor.speed}</span></div>
                                                        <div>í”¼ê²© í™•ë¥ : <span className="text-yellow-300">{settings.meteor.hitChance}</span></div>
                                                    </div>
                                                </div>

                                                {/* í”Œë ˆì´ì–´ ì„¤ì • */}
                                                <div className="mb-4">
                                                    <h4 className="font-bold text-blue-400 mb-2">ğŸš€ í”Œë ˆì´ì–´</h4>
                                                    <div className="text-sm space-y-1">
                                                        <div>ì´ë™ ì†ë„: <span className="text-yellow-300">{settings.player.speed}</span></div>
                                                        <div>íˆíŠ¸ë°•ìŠ¤: <span className="text-yellow-300">{settings.player.hitboxSize}</span></div>
                                                    </div>
                                                </div>

                                                {/* ì•„ì´í…œ ì„¤ì • */}
                                                <div>
                                                    <h4 className="font-bold text-green-400 mb-2">ğŸ ì•„ì´í…œ</h4>
                                                    <div className="text-sm space-y-2">
                                                        <div>
                                                            <div className="font-semibold">ğŸ’ ë³´ì„</div>
                                                            <div>ë¹ˆë„: {settings.items.gem.frequency}</div>
                                                            <div>í™•ë¥ : {settings.items.gem.chance}</div>
                                                            <div>ì†ë„: {settings.items.gem.speed}</div>
                                                        </div>
                                                        <div>
                                                            <div className="font-semibold">ğŸ’– í•˜íŠ¸</div>
                                                            <div>ë¹ˆë„: {settings.items.heart.frequency}</div>
                                                            <div>í™•ë¥ : {settings.items.heart.chance}</div>
                                                            <div>ì†ë„: {settings.items.heart.speed}</div>
                                                        </div>
                                                        <div>
                                                            <div className="font-semibold">ğŸ›¡ï¸ ì‹¤ë“œ</div>
                                                            <div>ë¹ˆë„: {settings.items.shield.frequency}</div>
                                                            <div>í™•ë¥ : {settings.items.shield.chance}</div>
                                                            <div>ì†ë„: {settings.items.shield.speed}</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* í˜„ì¬ ìŠ¤í‚¬ íš¨ê³¼ */}
                                <div className="bg-black bg-opacity-50 rounded-lg p-6">
                                    <h2 className="text-2xl font-bold mb-4 text-center">âš¡ í˜„ì¬ ì ìš©ëœ ìŠ¤í‚¬ íš¨ê³¼</h2>
                                    
                                    <div className="grid md:grid-cols-2 gap-4">
                                        <div className="bg-gray-800 rounded-lg p-4">
                                            <h3 className="text-lg font-bold mb-3 text-purple-400">ì´ë™ & ë°©ì–´ ìŠ¤í‚¬</h3>
                                            <div className="space-y-2 text-sm">
                                                <div>ğŸš€ ìŠ¤í”¼ë“œ ë¶€ì¸ : <span className="text-yellow-300">ë ˆë²¨ {skills.speedBoots} (+{(skills.speedBoots * 15).toFixed(0)}% ì†ë„)</span></div>
                                                <div>ğŸ¯ ì‘ì€ íˆíŠ¸ë°•ìŠ¤: <span className="text-yellow-300">{skills.smallHitbox ? 'í™œì„±í™” (40% ì¶•ì†Œ)' : 'ë¹„í™œì„±í™”'}</span></div>
                                                <div>ğŸ’– ì¶”ê°€ ìƒëª…: <span className="text-yellow-300">+{skills.extraLife}ê°œ</span></div>
                                            </div>
                                        </div>
                                        
                                        <div className="bg-gray-800 rounded-lg p-4">
                                            <h3 className="text-lg font-bold mb-3 text-orange-400">ë©”í…Œì˜¤ ì–µì œ ìŠ¤í‚¬</h3>
                                            <div className="space-y-2 text-sm">
                                                <div>ğŸŒ€ ìŠ¬ë¡œìš° í•„ë“œ: <span className="text-yellow-300">ë ˆë²¨ {skills.slowField} (-{(skills.slowField * 7).toFixed(0)}% ì†ë„)</span></div>
                                                <div>â˜‚ï¸ ë©”í…Œì˜¤ ì–µì œê¸°: <span className="text-yellow-300">ë ˆë²¨ {skills.meteorSuppressor} (-{(skills.meteorSuppressor * 9).toFixed(0)}% ë°€ë„)</span></div>
                                            </div>
                                        </div>
                                        
                                        <div className="bg-gray-800 rounded-lg p-4">
                                            <h3 className="text-lg font-bold mb-3 text-green-400">ë³´ì„ ê´€ë ¨ ìŠ¤í‚¬</h3>
                                            <div className="space-y-2 text-sm">
                                                <div>ğŸ’ ë³´ì„ í™•ë¥  ì¦í­ê¸°: <span className="text-yellow-300">ë ˆë²¨ {skills.gemAmplifier} (+{(skills.gemAmplifier * 5).toFixed(0)}% í™•ë¥ )</span></div>
                                                <div>ğŸ§² ë³´ì„ ìì„: <span className="text-yellow-300">{skills.gemMagnet ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”'}</span></div>
                                                <div>ğŸ’° ë³´ì„ ì ìˆ˜ ì¦í­: <span className="text-yellow-300">{skills.gemScoreAmp ? 'í™œì„±í™” (2ë°°)' : 'ë¹„í™œì„±í™”'}</span></div>
                                            </div>
                                        </div>
                                        
                                        <div className="bg-gray-800 rounded-lg p-4">
                                            <h3 className="text-lg font-bold mb-3 text-cyan-400">ê²Œì„ ì •ë³´</h3>
                                            <div className="space-y-2 text-sm">
                                                <div>í˜„ì¬ ì½”ì¸: <span className="text-yellow-300">{coins}ê°œ</span></div>
                                                <div>ìµœê³  ë ˆë²¨: <span className="text-yellow-300">{bestRecord.level}</span></div>
                                                <div>ìµœê³  ì ìˆ˜: <span className="text-yellow-300">{bestRecord.score}ì </span></div>
                                                <div>ì—°ìŠµ ì •ë‹µë¥ : <span className="text-yellow-300">{practiceStats.totalProblems > 0 ? Math.round((practiceStats.correctAnswers / practiceStats.totalProblems) * 100) : 0}%</span></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* ê²Œì„ ë°¸ëŸ°ìŠ¤ ê³µì‹ */}
                                <div className="bg-black bg-opacity-50 rounded-lg p-6">
                                    <h2 className="text-2xl font-bold mb-4 text-center">ğŸ“ ê²Œì„ ë°¸ëŸ°ìŠ¤ ê³µì‹</h2>
                                    
                                    <div className="grid md:grid-cols-2 gap-4 text-sm">
                                        <div className="bg-gray-800 rounded-lg p-4">
                                            <h3 className="font-bold text-red-400 mb-2">ë©”í…Œì˜¤ ê³µì‹</h3>
                                            <div className="space-y-1 font-mono text-xs">
                                                <div>ìƒì„±ë¹ˆë„ = ë ˆë²¨1~10: ë°°ì—´[200~28]ms, ë ˆë²¨11+: max(5, 28-ì¶”ê°€ë ˆë²¨Ã—2)ms</div>
                                                <div>ìƒì„±í™•ë¥  = ë ˆë²¨1~10: ë°°ì—´[1.2~8.0], ë ˆë²¨11+: min(15.0, 8.0+ì¶”ê°€ë ˆë²¨Ã—0.5) - ì–µì œê¸°Ã—0.09</div>
                                                <div>ë‚™í•˜ì†ë„ = ë ˆë²¨1~10: ë°°ì—´[5.0~55.0], ë ˆë²¨11+: min(100.0, 55.0+ì¶”ê°€ë ˆë²¨Ã—3.0) Ã— max(0.3, 1-ìŠ¬ë¡œìš°Ã—0.07)</div>
                                                <div>í”¼ê²©í™•ë¥  = (30Ã—30) / (íˆíŠ¸ë°•ìŠ¤í¬ê¸°Â²) Ã— 100%</div>
                                                <div>ë™ì‹œìƒì„± = ë ˆë²¨2~8: 2~8ê°œ, ë ˆë²¨9~12: 9~12ê°œ, ë ˆë²¨13+: ìµœëŒ€15ê°œ, ë ˆë²¨15+: ìµœëŒ€20ê°œ</div>
                                            </div>
                                        </div>
                                        
                                        <div className="bg-gray-800 rounded-lg p-4">
                                            <h3 className="font-bold text-blue-400 mb-2">í”Œë ˆì´ì–´ ê³µì‹</h3>
                                            <div className="space-y-1 font-mono text-xs">
                                                <div>ì´ë™ì†ë„ = 5 Ã— (1 + ìŠ¤í”¼ë“œë¶€ì¸ ë ˆë²¨ Ã— 0.15)</div>
                                                <div>íˆíŠ¸ë°•ìŠ¤ = ì‘ì€íˆíŠ¸ë°•ìŠ¤ ? 18 : 30</div>
                                                <div>ê¸°ë³¸ìƒëª… = 2 + ì¶”ê°€ìƒëª…ë ˆë²¨</div>
                                                <div>ë¬´ì ì‹œê°„ = í”¼ê²©í›„ 1ì´ˆ, ì‹¤ë“œ 4ì´ˆ</div>
                                            </div>
                                        </div>
                                        
                                        <div className="bg-gray-800 rounded-lg p-4">
                                            <h3 className="font-bold text-green-400 mb-2">ì•„ì´í…œ ê³µì‹</h3>
                                            <div className="space-y-1 font-mono text-xs">
                                                <div>ë³´ì„í™•ë¥  = 0.3 + ì¦í­ê¸°ë ˆë²¨ Ã— 0.05</div>
                                                <div>í•˜íŠ¸í™•ë¥  = 0.25 (ê³ ì •)</div>
                                                <div>ì‹¤ë“œí™•ë¥  = 0.35 (ê³ ì •)</div>
                                                <div>ìì„ë²”ìœ„ = 80px (ë³´ì„ìì„ ë³´ìœ ì‹œ)</div>
                                            </div>
                                        </div>
                                        
                                        <div className="bg-gray-800 rounded-lg p-4">
                                            <h3 className="font-bold text-yellow-400 mb-2">ì ìˆ˜ ê³µì‹</h3>
                                            <div className="space-y-1 font-mono text-xs">
                                                <div>ìƒì¡´ì ìˆ˜ = 1ì /ì´ˆ</div>
                                                <div>ë³´ì„ì ìˆ˜ = ì ìˆ˜ì¦í­ ? 200 : 100</div>
                                                <div>ë³´ì„ì½”ì¸ = ì ìˆ˜ì¦í­ ? 4 : 2</div>
                                                <div>ì—°ìŠµì½”ì¸ = 5 + floor(ì—°ì†ì •ë‹µ/5) Ã— 2</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div className="text-center">
                                <button
                                    onClick={() => setShowAdminConsole(false)}
                                    className="bg-blue-600 hover:bg-blue-700 px-8 py-3 rounded-lg font-bold text-lg transition-colors"
                                >
                                    â† ë©”ì¸ ë©”ë‰´ë¡œ ëŒì•„ê°€ê¸°
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-full bg-gradient-to-b from-purple-900 to-blue-900 text-white">
                    <div className="container mx-auto px-4 py-6 max-w-4xl">
                        {/* í—¤ë” */}
                        <div className="text-center mb-6">
                            <h1 className="text-4xl font-bold mb-2">Division Quest1.131 âš”ï¸</h1>
                            <div className="flex justify-center items-center gap-4 text-lg">
                                <span>ğŸ’° {coins}</span>
                                <span>ğŸ† {getTitle(bestRecord.level)}</span>
                            </div>
                            <div className="mt-2 flex justify-center gap-2">
                                <button
                                    onClick={() => {
                                        if (window.confirm('ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ë¦¬ì…‹í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ì½”ì¸, ìŠ¤í‚¬, ì—°ìŠµ ê¸°ë¡, ê²Œì„ ê¸°ë¡ ëª¨ë‘ ì‚­ì œë©ë‹ˆë‹¤)')) {
                                            resetAllData();
                                        }
                                    }}
                                    className="bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-sm transition-colors"
                                >
                                    ì „ì²´ ë°ì´í„° ë¦¬ì…‹
                                </button>
                                <button
                                    onClick={openAdminConsole}
                                    className="bg-gray-600 hover:bg-gray-700 px-3 py-1 rounded text-sm transition-colors"
                                >
                                    ê´€ë¦¬ì ì½˜ì†”
                                </button>
                            </div>
                        </div>

                        {/* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */}
                        <div className="flex justify-center mb-6">
                            <div className="bg-black bg-opacity-30 rounded-lg p-1 flex">
                                {[
                                    { key: 'practice', label: 'ì—°ìŠµ', icon: 'ğŸ“š' },
                                    { key: 'shop', label: 'ìŠ¤í‚¬ ìƒì ', icon: 'ğŸ›’' },
                                    { key: 'game', label: 'ë¯¸ë‹ˆê²Œì„', icon: 'ğŸ®' }
                                ].map(tab => (
                                    <button
                                        key={tab.key}
                                        onClick={() => {
                                            setActiveTab(tab.key);
                                            initializeAudio();
                                        }}
                                        className={`px-6 py-3 rounded-md transition-all ${
                                            activeTab === tab.key 
                                                ? 'bg-blue-600 text-white' 
                                                : 'text-gray-300 hover:text-white hover:bg-gray-700'
                                        }`}
                                    >
                                        {tab.icon} {tab.label}
                                    </button>
                                ))}
                            </div>
                        </div>

                        {/* ì—°ìŠµ íƒ­ */}
                        {activeTab === 'practice' && (
                            <div className="bg-black bg-opacity-30 rounded-lg p-6">
                                <h2 className="text-2xl font-bold mb-4 text-center">ë‚˜ëˆ—ì…ˆ ì—°ìŠµ</h2>
                                
                                {/* í†µê³„ */}
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                                    <div className="bg-blue-600 rounded-lg p-3 text-center">
                                        <div className="text-2xl font-bold">{practiceStats.totalProblems}</div>
                                        <div className="text-sm">í‘¼ ë¬¸ì œ</div>
                                    </div>
                                    <div className="bg-green-600 rounded-lg p-3 text-center">
                                        <div className="text-2xl font-bold">{practiceStats.correctAnswers}</div>
                                        <div className="text-sm">ì •ë‹µ ìˆ˜</div>
                                    </div>
                                    <div className="bg-yellow-600 rounded-lg p-3 text-center">
                                        <div className="text-2xl font-bold">
                                            {practiceStats.totalProblems > 0 
                                                ? Math.round((practiceStats.correctAnswers / practiceStats.totalProblems) * 100)
                                                : 0}%
                                        </div>
                                        <div className="text-sm">ì •ë‹µë¥ </div>
                                    </div>
                                    <div className="bg-purple-600 rounded-lg p-3 text-center">
                                        <div className="text-2xl font-bold">{practiceStats.streak}</div>
                                        <div className="text-sm">ì—°ì† ì •ë‹µ</div>
                                    </div>
                                </div>

                                

                                


                                



                                {/* ë¬¸ì œ */}
                                {currentProblem && (
                                    <div className="text-center mb-6">
                                        <div className="text-3xl mb-4">
                                            {currentProblem.dividend} Ã· {currentProblem.divisor} = ?
                                        </div>
                                        <div className="mb-4 flex justify-center items-center gap-4">
                                            <div className="flex flex-col items-center">
                                                <label className="text-sm text-gray-300 mb-1">ëª«</label>
                                                <input
                                                    type="number"
                                                    value={userAnswer.split(',')[0] || ''}
                                                    onChange={(e) => {
                                                        const quotient = e.target.value;
                                                        const remainder = userAnswer.split(',')[1] || '';
                                                        setUserAnswer(`${quotient},${remainder}`);
                                                    }}
                                                    placeholder="0"
                                                    className="px-4 py-2 rounded-lg bg-gray-800 text-white text-center text-lg w-20"
                                                    onKeyPress={(e) => e.key === 'Enter' && checkAnswer()}
                                                />
                                            </div>
                                            <div className="text-2xl">ë‚˜ë¨¸ì§€</div>
                                            <div className="flex flex-col items-center">
                                                <label className="text-sm text-gray-300 mb-1">ë‚˜ë¨¸ì§€</label>
                                                <input
                                                    type="number"
                                                    value={userAnswer.split(',')[1] || ''}
                                                    onChange={(e) => {
                                                        const quotient = userAnswer.split(',')[0] || '';
                                                        const remainder = e.target.value;
                                                        setUserAnswer(`${quotient},${remainder}`);
                                                    }}
                                                    placeholder="0"
                                                    className="px-4 py-2 rounded-lg bg-gray-800 text-white text-center text-lg w-20"
                                                    onKeyPress={(e) => e.key === 'Enter' && checkAnswer()}
                                                />
                                            </div>
                                        </div>
                                        <button
                                            onClick={checkAnswer}
                                            className="bg-blue-600 hover:bg-blue-700 px-6 py-3 rounded-lg font-bold transition-colors"
                                        >
                                            í™•ì¸
                                        </button>
                                        <div className="text-sm text-gray-300 mt-2">
                                            ëª«ê³¼ ë‚˜ë¨¸ì§€ë¥¼ ê°ê° ì…ë ¥í•˜ì„¸ìš”
                                        </div>

                                        {practiceStats.streak > 0 && practiceStats.streak % 3 !== 0 && (
                                            <div className="text-green-400 mt-2">
                                                ğŸ’° ê¸°ë³¸ ì½”ì¸ 5ê°œ íšë“! (ë‹¤ìŒ ë³´ë„ˆìŠ¤ê¹Œì§€ {3 - (practiceStats.streak % 3)}íšŒ)
                                            </div>
                                        )}

                                        {/* ì¡°ê±´ 2: 3ì˜ ë°°ìˆ˜ì¼ ë•Œ (3, 6, 9íšŒ...) */}
                                        {practiceStats.streak > 0 && practiceStats.streak % 3 === 0 && (
                                            <div className="text-yellow-400 mt-2">
                                                ğŸ”¥ {practiceStats.streak}ì—°ì† ì •ë‹µ! ê¸°ë³¸ 5ê°œ + **ë³´ë„ˆìŠ¤ 10ê°œ** íšë“!
                                            </div>
                                        )}
                                    </div>
                                )}
                            </div>
                        )}

                        {/* ìŠ¤í‚¬ ìƒì  íƒ­ */}
                        {activeTab === 'shop' && (
                            <div className="bg-black bg-opacity-30 rounded-lg p-6">
                                <h2 className="text-2xl font-bold mb-4 text-center">ìŠ¤í‚¬ ìƒì </h2>
                                <div className="grid gap-4">
                                    {skillsData.map(skill => {
                                        // ë ˆë²¨ì´ ì—†ëŠ” ê²½ìš° 0ìœ¼ë¡œ ì²˜ë¦¬
                                        const currentLevel = skills[skill.key] || 0;
                                        
                                        // ìŠ¤íƒ ê°€ëŠ¥í•œ ìŠ¤í‚¬ì´ MAX_LEVELì— ë„ë‹¬í–ˆëŠ”ì§€ í™•ì¸
                                        const isMaxLevel = skill.stackable && currentLevel >= MAX_LEVEL; 

                                        // êµ¬ë§¤ ê°€ëŠ¥ ì¡°ê±´ ì—…ë°ì´íŠ¸:
                                        // ì½”ì¸ì´ ì¶©ë¶„í•˜ê³  AND
                                        // (ìŠ¤íƒ ê°€ëŠ¥í•œë° ìµœëŒ€ ë ˆë²¨ì´ ì•„ë‹ˆê±°ë‚˜) OR
                                        // (ìŠ¤íƒ ë¶ˆê°€ëŠ¥í•œë° ì•„ì§ êµ¬ë§¤í•˜ì§€ ì•Šì€ ê²½ìš°)
                                        const canBuy = coins >= skill.price && (
                                            (skill.stackable && !isMaxLevel) || 
                                            (!skill.stackable && !currentLevel)
                                        );

                                        // ìŠ¤í‚¬ êµ¬ë§¤ í•¸ë“¤ëŸ¬: canBuyê°€ trueì¼ ë•Œë§Œ êµ¬ë§¤ ì‹¤í–‰
                                        const handleBuy = () => {
                                            if (canBuy) {
                                                buySkill(skill.key, skill.price);
                                            }
                                        };
                                        
                                        return (
                                            <div key={skill.key} className="bg-gray-800 rounded-lg p-4 flex justify-between items-center">
                                                <div>
                                                    <div className="font-bold">{skill.name}</div>
                                                    <div className="text-sm text-gray-300">{skill.desc}</div>
                                                    {skill.stackable && (
                                                        <div className="text-sm font-semibold">
                                                            {/* ìµœëŒ€ ë ˆë²¨ ë„ë‹¬ ì‹œ í…ìŠ¤íŠ¸ ë° ìƒ‰ìƒ ë³€ê²½ */}
                                                            <span className={isMaxLevel ? 'text-red-400' : 'text-yellow-400'}>
                                                                {isMaxLevel ? `MAX (Lv.${currentLevel})` : `í˜„ì¬ ë ˆë²¨: ${currentLevel}`}
                                                            </span>
                                                        </div>
                                                    )}
                                                    {!skill.stackable && currentLevel > 0 && (
                                                        <div className="text-sm text-green-400">ë³´ìœ  ì¤‘</div>
                                                    )}
                                                </div>
                                                <button
                                                    onClick={handleBuy}
                                                    disabled={!canBuy}
                                                    className={`px-4 py-2 rounded-lg font-bold transition-colors ${
                                                        canBuy
                                                            ? 'bg-green-600 hover:bg-green-700 text-white'
                                                            : 'bg-gray-600 text-gray-400 cursor-not-allowed'
                                                    }`}
                                                >
                                                    {/* ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½: ìµœëŒ€ ë ˆë²¨ ë˜ëŠ” ë³´ìœ  ì¤‘ì¼ ë•Œ */}
                                                    {isMaxLevel ? 'ìµœëŒ€ ë ˆë²¨' : !skill.stackable && currentLevel > 0 ? 'ë³´ìœ  ì¤‘' : `ğŸ’° ${skill.price}`}
                                                </button>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        )}

                        {/* ë¯¸ë‹ˆê²Œì„ íƒ­ */}
                        {activeTab === 'game' && (
                            <div className="flex gap-6">
                                {/* ê²Œì„ ì˜ì—­ */}
                                <div className="flex-1 bg-black bg-opacity-30 rounded-lg p-6">
                                    <h2 className="text-2xl font-bold mb-4 text-center">ë©”í…Œì˜¤ ê²Œì„</h2>
                                    
                                    {gameState === 'menu' && (
                                        <div className="text-center">
                                            <div className="mb-6">
                                                <div className="text-lg mb-2">ìµœê³  ê¸°ë¡</div>
                                                <div className="text-2xl font-bold text-yellow-400">
                                                    ë ˆë²¨ {bestRecord.level} | {bestRecord.score}ì 
                                                </div>
                                            </div>
                                            
                                            <div className="mb-6">
                                                <div className="text-lg mb-2">ë³´ìœ  ìŠ¤í‚¬</div>
                                                <div className="flex flex-wrap justify-center gap-2 mb-4">
                                                    {skillsData.map(skill => {
                                                        const level = skills[skill.key];
                                                        if (level > 0 || level === true) {
                                                            return (
                                                                <div key={skill.key} className="bg-blue-600 px-3 py-2 rounded-lg text-sm">
                                                                    <div className="font-bold">{skill.name}</div>
                                                                    <div className="text-xs text-blue-200">
                                                                        {typeof level === 'number' && level > 1 ? `ë ˆë²¨ ${level}` : 'ë³´ìœ '}
                                                                    </div>
                                                                </div>
                                                            );
                                                        }
                                                        return null;
                                                    })}
                                                    {skillsData.every(skill => !skills[skill.key] || skills[skill.key] === 0) && (
                                                        <div className="text-gray-400 text-sm">ë³´ìœ í•œ ìŠ¤í‚¬ì´ ì—†ìŠµë‹ˆë‹¤</div>
                                                    )}
                                                </div>
                                            </div>
                                            
                                            <button
                                                onClick={startGame}
                                                disabled={coins < 10}
                                                className={`px-8 py-4 rounded-lg font-bold text-xl transition-colors ${
                                                    coins >= 10 
                                                        ? 'bg-green-600 hover:bg-green-700 text-white' 
                                                        : 'bg-gray-600 text-gray-400 cursor-not-allowed'
                                                }`}
                                            >
                                                ğŸš€ ê²Œì„ ì‹œì‘ (ğŸ’° 10)
                                            </button>

                                            {/* í•˜ë“œëª¨ë“œ ë²„íŠ¼ */}
                                            {bestRecord.level >= 10 && (
                                                <button
                                                    onClick={() => startGame('hard')}
                                                    disabled={coins < 20}
                                                    className={`px-8 py-4 rounded-lg font-bold text-xl transition-colors block mx-auto ${
                                                        coins >= 20 
                                                            ? 'bg-red-600 hover:bg-red-700 text-white' 
                                                            : 'bg-gray-600 text-gray-400 cursor-not-allowed'
                                                    }`}
                                                >
                                                    ğŸ”¥ ìŠ¤í‚µëª¨ë“œ (ë ˆë²¨ 10 ì‹œì‘) (ğŸ’° 20)
                                                </button>
                                            )}


                                            {coins < 10 && (
                                                <div className="text-red-400 text-sm mt-2">
                                                    ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤! ì—°ìŠµ ëª¨ë“œì—ì„œ ì½”ì¸ì„ ëª¨ì•„ë³´ì„¸ìš”.
                                                </div>
                                            )}
                                        </div>
                                    )}

                                    {bestRecord.level >= 10 && coins >= 10 && coins < 20 && (
                                        <div className="text-yellow-400 text-sm mt-2">
                                            í•˜ë“œëª¨ë“œëŠ” 20ì½”ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.
                                        </div>
                                    )}
                                    
                                    {gameState === 'playing' && (
                                        <MeteorGameHard 
                                            skills={skills}
                                            onGameEnd={handleGameEnd}
                                            onScoreUpdate={handleScoreUpdate}
                                            onCoinsUpdate={handleCoinsUpdate}
                                            startLevel={gameMode === 'hard' ? 10 : 1}

                                        />
                                    )}
                                    
                                    {gameState === 'gameOver' && (
                                        <div className="text-center">
                                            <div className="text-3xl font-bold mb-4 text-red-400">ê²Œì„ ì˜¤ë²„!</div>
                                            <div className="mb-6">
                                                <div className="text-xl mb-2">ì´ë²ˆ ê²Œì„ ê²°ê³¼</div>
                                                <div className="text-2xl font-bold text-yellow-400 mb-2">
                                                    ë ˆë²¨ {lastGameResult.level} | {lastGameResult.score}ì 
                                                </div>
                                                {(lastGameResult.level > bestRecord.level || lastGameResult.score > bestRecord.score) && (
                                                    <div className="text-green-400 font-bold">ğŸ‰ ì‹ ê¸°ë¡ ë‹¬ì„±!</div>
                                                )}
                                            </div>
                                            <button
                                                onClick={startGame}
                                                disabled={coins < 10}
                                                className={`px-8 py-4 rounded-lg font-bold text-xl transition-colors ${
                                                    coins >= 10 
                                                        ? 'bg-green-600 hover:bg-green-700 text-white' 
                                                        : 'bg-gray-600 text-gray-400 cursor-not-allowed'
                                                }`}
                                            >
                                                ğŸš€ ë‹¤ì‹œ ì‹œì‘ (ğŸ’° 10)
                                            </button>

                                            {/* í•˜ë“œëª¨ë“œ ë²„íŠ¼ */}
                                            {bestRecord.level >= 10 && (
                                                <button
                                                    onClick={() => startGame('hard')}
                                                    disabled={coins < 20}
                                                    className={`px-8 py-4 rounded-lg font-bold text-xl transition-colors block mx-auto ${
                                                        coins >= 20 
                                                            ? 'bg-red-600 hover:bg-red-700 text-white' 
                                                            : 'bg-gray-600 text-gray-400 cursor-not-allowed'
                                                    }`}
                                                >
                                                    ğŸ”¥ í•˜ë“œëª¨ë“œ (ë ˆë²¨ 10 ì‹œì‘) (ğŸ’° 20)
                                                </button>
                                            )}


                                            {coins < 10 && (
                                                <div className="text-red-400 text-sm mt-2">
                                                    ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤! ì—°ìŠµ ëª¨ë“œì—ì„œ ì½”ì¸ì„ ëª¨ì•„ë³´ì„¸ìš”.
                                                </div>
                                            )}
                                        </div>
                                    )}
                                </div>

                                {/* ê¸°ë¡ & ì¹­í˜¸ íŒ¨ë„ */}
                                <div className="w-80 bg-black bg-opacity-30 rounded-lg p-4">
                                    <h3 className="text-xl font-bold mb-4 text-center">ê¸°ë¡ & ì¹­í˜¸ (ë¡œì»¬ ì €ì¥)</h3>
                                    
                                    {/* ë³´ìœ  ìŠ¤í‚¬ */}
                                    <div className="mb-6">
                                        <h4 className="text-lg font-bold mb-3 text-center">ë³´ìœ  ìŠ¤í‚¬</h4>
                                        <div className="space-y-2 max-h-40 overflow-y-auto">
                                            {skillsData.map(skill => {
                                                const level = skills[skill.key];
                                                if (level > 0 || level === true) {
                                                    return (
                                                        <div key={skill.key} className="bg-blue-600 rounded-lg p-2">
                                                            <div className="flex justify-between items-center">
                                                                <div>
                                                                    <div className="font-bold text-sm">{skill.name}</div>
                                                                    <div className="text-xs text-blue-200">{skill.desc}</div>
                                                                </div>
                                                                <div className="text-xs text-blue-200 ml-2">
                                                                    {typeof level === 'number' && level > 1 ? `Lv.${level}` : 'ë³´ìœ '}
                                                                </div>
                                                            </div>
                                                        </div>
                                                    );
                                                }
                                                return null;
                                            })}
                                            {skillsData.every(skill => !skills[skill.key] || skills[skill.key] === 0) && (
                                                <div className="text-gray-400 text-sm text-center py-4">ë³´ìœ í•œ ìŠ¤í‚¬ì´ ì—†ìŠµë‹ˆë‹¤</div>
                                            )}
                                        </div>
                                    </div>
                                    
                                    {/* í˜„ì¬ ê¸°ë¡ */}
                                    <div className="mb-6">
                                        <div className="bg-gray-800 rounded-lg p-4 mb-4">
                                            <div className="text-center">
                                                <div className="text-lg font-bold text-yellow-400 mb-2">
                                                    ìµœê³  ë ˆë²¨: {bestRecord.level}
                                                </div>
                                                <div className="text-lg font-bold text-green-400 mb-2">
                                                    ìµœê³  ì ìˆ˜: {bestRecord.score}
                                                </div>
                                                <div className="text-lg font-bold text-purple-400">
                                                    ì¹­í˜¸: {getTitle(bestRecord.level)}
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* ì¹­í˜¸ ëª©ë¡ */}
                                    <div className="mb-4">
                                        <h4 className="text-lg font-bold mb-3 text-center">ì¹­í˜¸ ëª©ë¡</h4>
                                        <div className="space-y-2 max-h-60 overflow-y-auto">
                                            {titleList.map(item => (
                                                <div 
                                                    key={item.level} 
                                                    className={`p-2 rounded text-sm ${
                                                        bestRecord.level >= item.level 
                                                            ? 'bg-green-600 text-white' 
                                                            : 'bg-gray-700 text-gray-400'
                                                    }`}
                                                >
                                                    <span className="font-bold">Lv.{item.level}:</span> {item.title}
                                                    {bestRecord.level >= item.level && (
                                                        <span className="float-right">âœ“</span>
                                                    )}
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    {/* ê¸°ë¡ ë¦¬ì…‹ ë²„íŠ¼ */}
                                    <div className="text-center">
                                        <button
                                            onClick={() => {
                                                if (window.confirm('ì •ë§ë¡œ ê²Œì„ ê¸°ë¡ì„ ë¦¬ì…‹í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                                                    resetRecord();
                                                }
                                            }}
                                            className="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg font-bold text-sm transition-colors"
                                        >
                                            ê²Œì„ ê¸°ë¡ ë¦¬ì…‹
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // Element SDK ì´ˆê¸°í™”
        if (window.elementSdk) {
            const defaultConfig = {
                background_color: "#1a1a2e",
                primary_color: "#3b82f6",
                text_color: "#ffffff",
                accent_color: "#10b981"
            };

            window.elementSdk.init({
                defaultConfig,
                onConfigChange: async (config) => {
                    const root = document.documentElement;
                    root.style.setProperty('--bg-color', config.background_color || defaultConfig.background_color);
                    root.style.setProperty('--primary-color', config.primary_color || defaultConfig.primary_color);
                    root.style.setProperty('--text-color', config.text_color || defaultConfig.text_color);
                    root.style.setProperty('--accent-color', config.accent_color || defaultConfig.accent_color);
                },
                mapToCapabilities: (config) => ({
                    recolorables: [
                        {
                            get: () => config.background_color || defaultConfig.background_color,
                            set: (value) => {
                                config.background_color = value;
                                window.elementSdk.setConfig({ background_color: value });
                            }
                        },
                        {
                            get: () => config.primary_color || defaultConfig.primary_color,
                            set: (value) => {
                                config.primary_color = value;
                                window.elementSdk.setConfig({ primary_color: value });
                            }
                        },
                        {
                            get: () => config.text_color || defaultConfig.text_color,
                            set: (value) => {
                                config.text_color = value;
                                window.elementSdk.setConfig({ text_color: value });
                            }
                        },
                        {
                            get: () => config.accent_color || defaultConfig.accent_color,
                            set: (value) => {
                                config.accent_color = value;
                                window.elementSdk.setConfig({ accent_color: value });
                            }
                        }
                    ],
                    borderables: [],
                    fontEditable: undefined,
                    fontSizeable: undefined
                }),
                mapToEditPanelValues: (config) => new Map()
            });
        }

        // ì•± ë Œë”ë§
        ReactDOM.render(<DivisionQuest />, document.getElementById('root'));
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'998d0ce8f626c6fe',t:'MTc2MjE4NTI2OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>